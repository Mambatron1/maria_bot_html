<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="no-cache">
    <meta name="cache-bust" content="maria-bot-v2.8.0-20251023-tasks">
    <meta name="version" content="maria-bot-v2.8.0-tasks-reminders">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="If-Modified-Since" content="0">
    <meta name="telegram-cache-version" content="v2.8.0-tasks">
    <title>NBtender ‚Äî Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind —Å –≤–∞—à–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nb-bg': '#eff6ff',
                        'nb-ink': '#0f172a',
                        'nb-muted': '#64748b',
                        'nb-graphite': '#474A51',
                        'nb-navy': {
                            600: '#274b7a',
                            700: '#1e3a5f',
                        },
                        'nb-accent': '#4338ca',
                        'nb-danger': '#ef4444',
                    },
                    borderRadius: {
                        'nb': '14px',
                    },
                    boxShadow: {
                        'nb': '0 6px 18px rgba(2, 6, 23, .12)',
                        'nb-strong': '0 10px 26px rgba(2, 6, 23, .18)',
                    },
                    spacing: {
                        'nb-pad': '16px',
                    }
                }
            }
        }
    </script>
    
    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –≤–∏–¥–æ–≤ –∫–µ—à–∞
        (function() {
            // –û—á–∏—Å—Ç–∫–∞ localStoage
            try { localStorage.clear(); } catch(e) {}
            
            // –û—á–∏—Å—Ç–∫–∞ sesionStorage  
            try { sessionStorage.clear(); } catch(e) {}
            
            // –û—á–∏—Å—Ç–∫–∞ Service Worker –∫–µ—à–∞
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
             
            // –û—á–∏—Å—Ç–∫–∞ Cache API
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                });
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π
            const timestamp = new Date().getTime();
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            links.forEach(link => {
                const href = link.href.split('?')[0];
                link.href = href + '?v=' + timestamp;
            });
        })();
    </script>
    <style>
        /* –¶–≤–µ—Ç–Ω—ã–µ —Ç–æ—á–∫–∏-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö */
        .dot { 
            display: inline-block; 
            width: 8px; 
            height: 8px; 
            border-radius: 50%;
        }

        .dot-holiday { background: #f59e0b; }
        .dot-mode { background: #10b981; }
        .dot-absence { background: #ef4444; }
        .dot-sick { background: #8b5cf6; }
        .dot-crocotime { background: #eab308; }

        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
        input[type="text"], 
        input[type="date"], 
        input[type="time"], 
        textarea,
        #my-response-input, 
        #admin-response-input, 
        #chat-message-input {
            color: white !important;
            background: #1e293b !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ —á–∞—Å–æ–≤ */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(1.5);
            cursor: pointer;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator:hover,
        input[type="time"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        /* –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
        #app {
            background: #eff6ff;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: auto;
        }

        /* üé® SPLASH SCREEN - –ó–∞—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–ê–Ø) */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
            padding: 20px;
        }

        #splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        #splash-logo {
            width: min(80vw, 450px);
            height: min(80vw, 450px);
            max-width: 450px;
            max-height: 450px;
            animation: splash-pulse 2s ease-in-out infinite;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
        }

        @keyframes splash-pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.08);
                opacity: 0.95;
            }
        }

        #splash-text {
            margin-top: 32px;
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
            text-shadow: none;
            animation: splash-fade 1.5s ease-in-out infinite;
            letter-spacing: 0.5px;
        }

        @keyframes splash-fade {
            0%, 100% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="m-0 bg-nb-bg text-nb-ink min-h-screen font-sans">
    <!-- üé® SPLASH SCREEN - –ó–∞—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ -->
    <div id="splash-screen">
        <img id="splash-logo" src="logo.svg" alt="Maria Bot">
        <div id="splash-text">–ó–∞–≥—Ä—É–∂–∞–µ–º—Å—è...</div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–µ—Ä—Å–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
    <div class="fixed top-2.5 right-2.5 bg-nb-accent text-white px-2 py-1 rounded-lg text-[10px] z-[9999]">
        Maria Bot v2.7.7-white-splash
    </div>
    
     
    <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å...</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö</p>
        </div>

        <div id="app" style="display: none;">
            <!-- Header -->
            <header class="flex items-center gap-3 mb-2">
                <div class="w-11 h-11 rounded-full bg-gray-300 overflow-hidden" id="avatar"></div>
                <div>
                    <div class="font-bold text-[17px]">–ü—Ä–∏–≤–µ—Ç, <span id="name">Aleksei</span></div>
                    <div class="text-xs text-nb-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            </div>
            </header>

            <!-- Cards Stack -->
            <div class="grid gap-2.5 my-2 mb-4">
                <div class="bg-emerald-800 text-slate-50 rounded-nb p-3 shadow-nb">
                    <h3 class="text-sm font-extrabold tracking-wide mb-1">–°–µ–≥–æ–¥–Ω—è</h3>
                    <p id="today-status" class="text-[13px] text-slate-200">üè¢ –û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</p>
                </div>
                <div class="bg-orange-600 text-slate-50 rounded-nb p-3 shadow-nb">
                    <h3 class="text-sm font-extrabold tracking-wide mb-1">–°–ª–µ–¥—É—é—â–∏–π –æ—Ç–ø—É—Å–∫</h3>
                    <p id="next-vacation" class="text-[13px] text-slate-200">–û—Ç–ø—É—Å–∫ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</p>
                </div>
                <div class="bg-indigo-800 text-slate-50 rounded-nb p-3 shadow-nb">
                    <h3 class="text-sm font-extrabold tracking-wide mb-1">–í —ç—Ç–æ—Ç –¥–µ–Ω—å</h3>
                    <p id="today-message" class="text-[13px] text-slate-200">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Maria Bot!</p>
                </div>
                </div>

            <!-- Action Buttons -->
            <div class="grid gap-3 justify-items-center">
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('vacation')">
                    <span class="dot dot-holiday"></span>
                    <span>–ú–æ–π –æ—Ç–ø—É—Å–∫</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('work_mode')">
                    <span class="dot dot-mode"></span>
                    <span>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('absence')">
                    <span class="dot dot-absence"></span>
                    <span>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('sick_leave')">
                    <span class="dot dot-sick"></span>
                    <span>–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('crocotime')">
                    <span class="dot dot-crocotime"></span>
                    <span>–ú–æ–π Crocotime</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" onclick="handleAction('tasks')">
                    <span class="dot" style="background: #06b6d4;"></span>
                    <span>–ú–æ–∏ –∑–∞–¥–∞—á–∏</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb relative" onclick="handleAction('sos')">
                    <span class="dot dot-absence"></span>
                    <span>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å</span>
                    <span id="sos-unread-badge" class="absolute top-1 right-1 bg-red-500 text-white text-[10px] font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1" style="display: none;"></span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-gradient-to-r from-purple-600 to-pink-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:from-purple-700 hover:to-pink-700 shadow-nb" id="hr-btn" onclick="handleAction('hr')" style="display: none;">
                    <span>üìä</span>
                    <span>HR-—Ä–µ–∂–∏–º</span>
                </button>
                <button class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb" id="admin-btn" onclick="handleAction('admin')" style="display: none;">
                    <span class="dot" style="background: #3b82f6;"></span>
                    <span>–ú–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
                </button>
                    </div>
        </div>

        <!-- Work Mode Modal -->
        <div id="work-mode-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</div>
            </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
                        <p class="text-[13px] text-slate-200">–£—Å—Ç–∞–Ω–æ–≤–∏ —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</p>
                    </div>
                </div>

                <div id="work-modes" class="grid gap-3 justify-items-center mb-8">
                    <!-- –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="period-section" class="grid gap-2.5 mt-8" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ –ø–µ—Ä–∏–æ–¥</h3>
                        <p class="text-[13px] text-slate-200">–£–∫–∞–∂–∏ –ø–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è —Ä–µ–∂–∏–º–∞</p>
                    </div>
                </div>

                <div id="work-periods" class="grid gap-5 justify-items-center mt-8" style="display: none;">
                    <!-- –ü–µ—Ä–∏–æ–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="custom-period" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–£–∫–∞–∂–∏ –ø–µ—Ä–∏–æ–¥</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                            <input type="date" id="start-date" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                            <input type="date" id="end-date" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                        </div>
                    </div>
                    <button onclick="submitWorkMode()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                    </button>
                </div>

                <div id="confirmation-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
                        <p id="confirmation-text" class="text-base leading-relaxed text-slate-200"><!-- –¢–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è --></p>
                        </div>
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="confirmWorkMode()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                            </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                            </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Absence Modal -->
        <div id="absence-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ</div>
            </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-danger text-white rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">‚ö†Ô∏è –í–∞–∂–Ω–æ!</h3>
                        <p class="text-[13px]"><strong>–°–ù–ê–ß–ê–õ–ê –°–û–ì–õ–ê–°–£–ô –° –†–£–ö–û–í–û–î–ò–¢–ï–õ–ï–ú, –ß–¢–û–ë–´ –û–ù –ó–ù–ê–õ, –ß–¢–û –¢–´ –û–¢–°–£–¢–°–¢–í–£–ï–®–¨!</strong></p>
                </div>
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb" id="absence-date-section">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É</h3>
                        <p class="text-[13px] text-slate-200">–£–∫–∞–∂–∏ –¥–∞—Ç—É —Ç–≤–æ–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è</p>
                    </div>
                </div>

                <div id="absence-dates" class="grid gap-3 justify-items-center mb-8">
                    <!-- –î–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="absence-time-section" class="grid gap-2.5 mt-8" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è</h3>
                        <p class="text-[13px] text-slate-200">–£–∫–∞–∂–∏ –≤—Ä–µ–º—è —Ç–≤–æ–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è</p>
                    </div>
                </div>

                <div id="absence-times" class="grid gap-5 justify-items-center mt-8" style="display: none;">
                    <!-- –í—Ä–µ–º–µ–Ω–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="absence-custom-date" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è:</label>
                            <input type="date" id="absence-date" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                        </div>
                    </div>
                    <button onclick="selectAbsenceCustomDate()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                    </button>
                </div>

                <div id="absence-custom-time" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                            <input type="time" id="absence-start-time" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                            <input type="time" id="absence-end-time" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                        </div>
                    </div>
                    <button onclick="submitAbsence()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                    </button>
                </div>

                <div id="absence-confirmation-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
                        <p id="absence-confirmation-text" class="text-base leading-relaxed text-slate-200"><!-- –¢–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è --></p>
                        </div>
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="confirmAbsence()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                            </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                            </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOS Modal -->
        <div id="sos-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã</h3>
                        <p class="text-[13px] text-slate-200">–£–∫–∞–∂–∏, —Å —á–µ–º —Å–≤—è–∑–∞–Ω–∞ —Ç–≤–æ—è –ø—Ä–æ–±–ª–µ–º–∞</p>
                    </div>
                </div>

                <div id="sos-issue-types" class="grid gap-3 justify-items-center">
                    <!-- –¢–∏–ø—ã –ø—Ä–æ–±–ª–µ–º –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ "–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è" -->
                <div class="grid gap-3 justify-items-center mt-5">
                    <button onclick="showSosMenuModal()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-indigo-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                        <span class="dot" style="background: #764ba2;"></span>
                        <span>–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</span>
                    </button>
                </div>

                <div id="sos-anonymity-section" class="grid gap-2.5 mt-8 mb-8" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ö–∞–∫ —Ç—ã —Ö–æ—á–µ—à—å –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è?</h3>
                        <p class="text-[13px] text-slate-200">–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±—Ä–∞—â–µ–Ω–∏—è</p>
                    </div>
                </div>

                <div id="sos-anonymity-options" class="grid justify-items-center mt-8" style="display: none; gap: 30px;">
                    <!-- –û–ø—Ü–∏–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="sos-pseudonym-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–£–∫–∞–∂–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ü—Å–µ–≤–¥–æ–Ω–∏–º:</label>
                            <input type="text" id="sos-pseudonym" placeholder="–í–≤–µ–¥–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>
                    </div>
                    
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="selectSosPseudonym()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
                        </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                        </button>
                    </div>
                </div>

                <div id="sos-description-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–û–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º—É</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</label>
                            <textarea id="sos-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏ —Ç–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)" class="w-full h-[120px] p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 resize-y text-[15px] font-bold"></textarea>
                        </div>
                    </div>
                    
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="submitSos()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                        </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                        </button>
                    </div>
                </div>

                <div id="sos-confirmation-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
                        <p id="sos-confirmation-text" class="text-base leading-relaxed text-slate-200"><!-- –¢–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è --></p>
                    </div>
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="confirmSos()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                        </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sick Leave Modal -->
        <div id="sick-leave-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–ë–æ–ª—å–Ω–∏—á–Ω—ã–π –ª–∏—Å—Ç</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-violet-600 text-white rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ú–Ω–µ –æ—á–µ–Ω—å –∂–∞–ª—å, —á—Ç–æ —Ç—ã –∑–∞–±–æ–ª–µ–ª(–∞)</h3>
                        <p class="text-[13px]">–î–∞–≤–∞–π –≤–Ω–µ—Å–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –±–æ–ª—å–Ω–∏—á–Ω–æ–º—É –ª–∏—Å—Ç—É (–≠–õ–ù)</p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ —Ç–∏–ø –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ</h3>
                        <p class="text-[13px] text-slate-200">–£–∫–∞–∂–∏ —Ç–∏–ø —Ç–≤–æ–µ–≥–æ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ –ª–∏—Å—Ç–∞</p>
                    </div>
                </div>

                <div id="sick-leave-types" class="grid gap-3 justify-items-center">
                    <!-- –¢–∏–ø—ã –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="sick-leave-form-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–î–∞–Ω–Ω—ã–µ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ù–æ–º–µ—Ä –≠–õ–ù:</label>
                            <input type="text" id="sick-leave-number" placeholder="–î–∞–Ω–Ω—ã–µ –≠–õ–ù" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                            <input type="date" id="sick-leave-start-date" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                            <input type="date" id="sick-leave-end-date" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                        </div>
                    </div>
                    
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="submitSickLeave()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                        </button>
                        <button onclick="showMainApp()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                        </button>
                    </div>
                </div>

                <div id="sick-leave-confirmation-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
                        <p id="sick-leave-confirmation-text" class="text-base leading-relaxed text-slate-200"><!-- –¢–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è --></p>
                    </div>
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="confirmSickLeave()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #10b981;"></span>
                            <span>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</span>
                        </button>
                        <button onclick="cancelSickLeave()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-red-900 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span class="dot" style="background: #ef4444;"></span>
                            <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crocotime Modal -->
        <div id="crocotime-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="closeCrocotimeModal()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üìä –ú–æ–π Crocotime</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-gradient-to-br from-yellow-500 to-amber-600 text-white rounded-nb p-4 shadow-nb">
                        <h3 class="text-base leading-relaxed font-bold mb-2">üéâ –ü—Ä–∏–≤–µ—Ç–∏–∫, –¥–æ—Ä–æ–≥—É—à–∞!</h3>
                        <p class="m-0 text-white/90 text-sm">
                        –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É —Ä–∞–∑–¥–µ–ª—É —Ç—ã —Å–º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ CrocoTime –∏ –≤–æ—Å—Ö–∏—Ç–∏—Ç—å—Å—è —Å–≤–æ–µ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é! üìä‚ú®
                        </p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–í—ã–±–µ—Ä–∏ –ø–µ—Ä–∏–æ–¥</h3>
                        <p class="text-[13px] text-slate-200">–í–∂—É—É—É—É—É—Ö!ü¶Ü –ü–æ—Å–º–æ—Ç—Ä–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω—É–∂–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
                    </div>
                </div>

                <div id="crocotime-periods" class="grid gap-4 justify-items-center">
                    <button onclick="loadCrocotimeStats('today')" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-gradient-to-r from-blue-600 to-blue-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="text-xl">üìÖ</span>
                        <span>–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å</span>
                    </button>
                    <button onclick="loadCrocotimeStats('week')" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-gradient-to-r from-green-600 to-green-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="text-xl">üìä</span>
                        <span>–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</span>
                    </button>
                    <button onclick="loadCrocotimeStats('month')" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-gradient-to-r from-purple-600 to-purple-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="text-xl">üìà</span>
                        <span>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</span>
                    </button>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div id="crocotime-stats-section" class="grid gap-2.5 mt-5" style="display: none;">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-4 shadow-nb">
                        <h3 id="crocotime-stats-title" class="text-base font-extrabold tracking-wide mb-3">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div id="crocotime-stats-content" class="text-slate-200 text-sm leading-relaxed">
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    
                    <div class="grid gap-3 justify-items-center">
                        <button onclick="hideCrocotimeStats()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-slate-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90">
                            <span>‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –ø–µ—Ä–∏–æ–¥–∞</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOS Menu Modal -->
        <div id="sos-menu-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</div>
            </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–¥–µ–ª–µ -->
                    <div class="bg-emerald-800 text-white rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold">üìã –¢–≤–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</h3>
                        <p class="m-0 text-white/80 text-sm">
                        –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
                        </p>
                </div>

                    <!-- –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π -->
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-base leading-relaxed font-bold mb-2">üí¨ –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>
                        <div id="sos-issues-list">
                            <div class="text-center text-nb-muted p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Issue Dialog Modal -->
        <div id="my-issue-dialog-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="closeMyIssueDialog()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üí¨ –ú–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ</div>
            </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-20">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb min-h-[60vh] max-h-[70vh] overflow-y-auto">
                <div id="my-issue-dialog-content">
                    <div class="text-center text-white/70 p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                    </div>
                </div>
            </div>
            
                <div class="fixed bottom-0 left-0 right-0 bg-nb-bg p-4 border-t border-white/10">
                    <div class="flex gap-2.5 max-w-full mx-auto">
                        <input type="text" id="my-response-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." onkeypress="handleMyResponseEnterKey(event)" oninput="handleUserTyping()" 
                               class="flex-1 p-3 border-none rounded-nb bg-slate-800 text-white text-sm border border-white/20">
                        <button onclick="sendMyResponse()" 
                                class="bg-nb-accent text-white border-none px-5 py-3 rounded-nb cursor-pointer font-semibold min-w-[100px] hover:opacity-90 active:scale-95 transition-all duration-200">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employees Management Modal -->
        <div id="employees-management-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showAdminMenuModal()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h3>
                        <p class="text-[13px] text-slate-200">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</p>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center mb-5">
                    <button onclick="showAddEmployeeModal()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</span>
                    </button>
                </div>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-1">–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h3>
                        <div class="mt-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ü–æ–∏—Å–∫:</label>
                            <input type="text" id="employee-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏..." 
                                   oninput="filterEmployees()" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–°—Ç–∞—Ç—É—Å:</label>
                            <select id="employee-status-filter" onchange="filterEmployees()" 
                                    class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                                <option value="all" class="bg-nb-bg text-white">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="active" class="bg-nb-bg text-white">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                <option value="blocked" class="bg-nb-bg text-white">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                                <option value="admin" class="bg-nb-bg text-white">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</option>
                            </select>
                            
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–†–æ–ª—å:</label>
                            <select id="employee-type-filter" onchange="filterEmployees()" 
                                    class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                                <option value="all" class="bg-nb-bg text-white">–í—Å–µ —Ä–æ–ª–∏</option>
                                <option value="admin" class="bg-nb-bg text-white">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</option>
                                <option value="user" class="bg-nb-bg text-white">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                            </select>
                        </div>
                        <div id="search-results-count" class="text-xs text-white/60 mt-2">
                            <!-- –°—á–µ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
                        </div>
                        </div>
                    </div>

                <div class="grid gap-2.5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                        <div id="employees-list">
                            <div class="text-center text-nb-muted p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Modal -->
        <div id="tasks-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üìù –ú–æ–∏ –∑–∞–¥–∞—á–∏</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div class="mb-4 flex gap-2 flex-wrap">
                    <button id="filter-all" onclick="filterTasks('all')" class="px-4 py-2 rounded-lg bg-nb-navy-700 text-white text-sm font-semibold transition-all duration-200 active:scale-95">–í—Å–µ</button>
                    <button id="filter-pending" onclick="filterTasks('pending')" class="px-4 py-2 rounded-lg bg-gray-300 text-gray-700 text-sm transition-all duration-200 active:scale-95">–í –æ–∂–∏–¥–∞–Ω–∏–∏</button>
                    <button id="filter-in_progress" onclick="filterTasks('in_progress')" class="px-4 py-2 rounded-lg bg-gray-300 text-gray-700 text-sm transition-all duration-200 active:scale-95">–í —Ä–∞–±–æ—Ç–µ</button>
                    <button id="filter-completed" onclick="filterTasks('completed')" class="px-4 py-2 rounded-lg bg-gray-300 text-gray-700 text-sm transition-all duration-200 active:scale-95">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</button>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
                <div id="tasks-list" class="space-y-3 mb-6">
                    <div class="text-center text-gray-500 p-5">
                        <div class="text-base">üìã –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>
                        <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                    </div>
                </div>

                <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
                <div class="mt-6">
                    <h3 class="font-bold text-lg mb-3">üîî –ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h3>
                    <div id="reminders-list" class="space-y-3">
                        <div class="text-center text-gray-500 p-5">
                            <div class="text-base">üîî –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π...</div>
                            <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Employee Modal -->
        <div id="add-employee-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showEmployeesManagement()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <p class="text-base leading-relaxed text-white/80">–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–Ω —Å–º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –±–æ—Ç–µ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">–§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</h3>
                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                            <input type="tel" id="add-phone" placeholder="+7XXXXXXXXXX" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ò–º—è:</label>
                            <input type="text" id="add-first-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="add-last-name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ì–æ—Ä–æ–¥ —Ä–∞–±–æ—Ç—ã:</label>
                            <input type="text" id="add-city" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</label>
                            <select id="add-work-mode" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                                <option value="office">–û—Ñ–∏—Å–Ω—ã–π</option>
                                <option value="remote_only">–£–¥–∞–ª–µ–Ω–Ω—ã–π</option>
                            </select>
                        </div>

                        <div class="mb-5">
                            <label class="flex items-center text-slate-50 cursor-pointer">
                                <input type="checkbox" id="add-is-admin" class="mr-2.5 scale-110">
                                <span class="font-bold">–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="addEmployee()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Employee Modal -->
        <div id="edit-employee-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showEmployeesManagement()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ</h3>
                        <p class="text-base leading-relaxed text-white/80">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –µ–≥–æ –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ</p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                            <input type="tel" id="edit-phone" readonly 
                                   class="w-full p-3 rounded-nb border border-gray-500 bg-gray-500 text-white/70 mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ò–º—è:</label>
                            <input type="text" id="edit-first-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="edit-last-name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–ì–æ—Ä–æ–¥ —Ä–∞–±–æ—Ç—ã:</label>
                            <input type="text" id="edit-city" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</label>
                            <select id="edit-work-mode" class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-5 text-[15px] font-bold">
                                <option value="office">–û—Ñ–∏—Å–Ω—ã–π</option>
                                <option value="remote_only">–£–¥–∞–ª–µ–Ω–Ω—ã–π</option>
                            </select>
                        </div>

                        <div class="mb-5">
                            <label class="flex items-center text-slate-50 cursor-pointer">
                                <input type="checkbox" id="edit-is-admin" class="mr-2.5 scale-110">
                                <span class="font-bold">–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="saveEmployeeChanges()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-orange-600 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="dot" style="background: #fbbf24;"></span>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Issues Management Modal -->
        <div id="issues-management-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showAdminMenuModal()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold mb-4">üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h3>
                        <div class="flex flex-col gap-2.5 mb-4">
                            <input type="text" id="issues-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É..." 
                                   oninput="filterIssues()" 
                                   class="w-full h-[52px] px-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold box-border">
                            <div class="flex gap-2.5">
                            <select id="issues-status-filter" onchange="filterIssues()" 
                                        class="flex-1 h-[52px] px-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold box-border">
                                <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="open">–û—Ç–∫—Ä—ã—Ç—ã–µ</option>
                                <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                                <option value="closed">–ó–∞–∫—Ä—ã—Ç—ã–µ</option>
                            </select>
                            <select id="issues-type-filter" onchange="filterIssues()" 
                                        class="flex-1 h-[52px] px-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold box-border">
                                <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="technical">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</option>
                                <option value="personal">–õ–∏—á–Ω—ã–µ</option>
                            </select>
                            </div>
                        </div>
                        <div id="issues-results-count" class="text-xs text-white/60">
                            <!-- –°—á–µ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π -->
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">üìã –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>
                        <div id="issues-list">
                            <div class="text-center text-nb-muted p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Issue Dialog Modal -->
        <div id="issue-dialog-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="closeIssueDialog()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üí¨ –î–∏–∞–ª–æ–≥ —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º</div>
            </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-20">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb min-h-[60vh] max-h-[70vh] overflow-y-auto">
                <div id="issue-dialog-content">
                            <div class="text-center text-white/70 p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                    </div>
                </div>
            </div>
            
                <div class="fixed bottom-0 left-0 right-0 bg-nb-bg p-4 border-t border-white/10">
                    <div class="flex gap-2.5 max-w-full mx-auto">
                        <input type="text" id="admin-response-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." onkeypress="handleEnterKey(event)" oninput="handleAdminTyping()"
                               class="flex-1 p-3 border-none rounded-nb bg-slate-800 text-white text-sm border border-white/20">
                        <button onclick="sendAdminResponse()" 
                                class="bg-nb-accent text-white border-none px-5 py-3 rounded-nb cursor-pointer font-semibold min-w-[100px]">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messaging Menu Modal -->
        <div id="messaging-menu-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showAdminMenuModal()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="showBroadcastMessage()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #ef4444;"></span>
                        <span>–°–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º</span>
                    </button>
                    <button onclick="showEmployeeMessageMenu()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #3b82f6;"></span>
                        <span>–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Broadcast Message Modal -->
        <div id="broadcast-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMessagingMenu()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–°–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ</h3>
                        <p class="text-base leading-relaxed text-white/80">–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                        <textarea id="broadcast-message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏..." 
                                  class="w-full h-[120px] p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 resize-y text-[15px] font-bold"></textarea>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-white/90 text-sm font-semibold">üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <div class="relative w-full">
                                <input type="file" id="broadcast-file" accept="*/*" 
                                       class="absolute w-full h-full opacity-0 cursor-pointer z-[2]"
                                       onchange="updateBroadcastFileInfo()">
                                <div id="broadcast-file-button" class="w-full p-3 rounded-nb border-2 border-dashed border-white/30 bg-white/5 text-white/70 text-sm font-semibold text-center cursor-pointer transition-all duration-200 flex items-center justify-center gap-2">
                                    <span>üìé</span>
                                    <span id="broadcast-file-button-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                </div>
                            </div>
                            <div id="broadcast-file-info" class="mt-2 text-xs text-white/70 hidden">
                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="sendBroadcastMessage()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Employee Message Modal -->
        <div id="employee-message-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMessagingMenu()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold mb-4">üë§ –í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                        <div class="flex gap-2.5 mb-4">
                            <input type="text" id="employee-message-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏..." 
                                   oninput="filterEmployeesForMessage()" 
                                   class="flex-1 p-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold">
                        </div>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">üë• –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                        <div id="employee-message-list">
                            <div class="text-center text-nb-muted p-5">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Send Message to Employee Modal -->
        <div id="send-employee-message-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showEmployeeMessageMenu()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0" id="employee-message-title">–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb mb-5">
                        <h3 class="text-base leading-relaxed font-bold">üí¨ –ü–æ–ª—É—á–∞—Ç–µ–ª—å</h3>
                        <p class="text-base leading-relaxed text-white/80" id="selected-employee-info">–í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</p>
                    </div>

                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-2">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                        <textarea id="employee-message-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..." 
                                  class="w-full h-[120px] p-3 rounded-nb border border-stone-400 bg-stone-400 text-white mb-4 resize-y text-[15px] font-bold"></textarea>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-white/90 text-sm font-semibold">üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <div class="relative w-full">
                                <input type="file" id="employee-message-file" accept="*/*" 
                                       class="absolute w-full h-full opacity-0 cursor-pointer z-[2]"
                                       onchange="updateEmployeeFileInfo()">
                                <div id="employee-file-button" class="w-full p-3 rounded-nb border-2 border-dashed border-white/30 bg-white/5 text-white/70 text-sm font-semibold text-center cursor-pointer transition-all duration-200 flex items-center justify-center gap-2">
                                    <span>üìé</span>
                                    <span id="file-button-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                </div>
                            </div>
                            <div id="employee-file-info" class="mt-2 text-xs text-white/70 hidden">
                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="sendEmployeeMessage()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-teal-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:opacity-90 shadow-nb">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Menu Modal -->
        <div id="admin-menu-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center gap-3 mb-2">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div>
                        <div class="font-bold text-[17px]">üëë –ú–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
                        <div class="text-xs text-nb-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</div>
            </div>
                </header>

                <div class="grid gap-2.5 my-2 mb-4">
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-3 shadow-nb">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-extrabold tracking-wide m-0">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                            <div class="flex items-center gap-2.5">
                                <div class="text-xs text-nb-muted">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="stats-update-time">–∑–∞–≥—Ä—É–∑–∫–∞...</span></div>
                                <button onclick="loadAdminStats()" class="bg-blue-500/10 border border-blue-500/20 text-blue-500 rounded-md px-2 py-1 text-xs cursor-pointer hover:bg-blue-500/20 transition-all">üîÑ</button>
                            </div>
                        </div>
                        <div id="admin-stats-content">
                            <div class="text-center p-5 text-nb-muted">
                                <div class="text-base">üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
                                <div class="text-xs mt-2">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid gap-3 justify-items-center">
                    <button onclick="showEmployeesManagement()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #10b981;"></span>
                        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</span>
                    </button>
                    <button onclick="showIssuesManagement()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #f59e0b;"></span>
                        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏</span>
                    </button>
                    <button onclick="sendStatsToChannel()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #3b82f6;"></span>
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–∞–Ω–∞–ª</span>
                    </button>
                    <button onclick="showMessagingMenu()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb">
                        <span class="dot" style="background: #ef4444;"></span>
                        <span>–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Issue Chat Modal -->
        <div id="issue-chat-modal" style="display: none;">
            <div class="header">
                <button onclick="showSosMenuModal()" style="background: none; border: none; color: white; font-size: 24px; float: left;">‚Üê</button>
                <h2 style="text-align: center; margin: 0;" id="chat-title">üí¨ –ß–∞—Ç –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é</h2>
            </div>

            <div style="padding: 20px; height: calc(100vh - 120px); display: flex; flex-direction: column;">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏ -->
                <div class="info-card" id="issue-info" style="margin-bottom: 15px;">
                    <div class="card-header">
                        <span class="card-icon">üìã</span>
                        <span class="card-title" id="issue-title">–û–±—Ä–∞—â–µ–Ω–∏–µ</span>
                    </div>
                    <div class="card-content" id="issue-description">
                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è -->
                    </div>
                </div>

                <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div id="chat-messages" style="flex: 1; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div id="chat-input-area" style="display: flex; gap: 10px;">
                    <input type="text" id="chat-message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: #1e293b; color: white;">
                    <button onclick="sendChatMessage()" style="padding: 12px 20px; background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; border-radius: 8px; color: white; font-weight: bold;">
                        üì§
                    </button>
                </div>
                
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ -->
                <div id="chat-closed-message" style="display: none; text-align: center; padding: 15px; background: rgba(255, 71, 87, 0.2); border-radius: 8px; color: #ff4757;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">üî¥ –û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ</div>
                    <div style="font-size: 14px;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∏–ª —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.</div>
                </div>
            </div>
        </div>

        <!-- HR Menu Modal -->
        <div id="hr-menu-modal" class="fixed inset-0 bg-nb-bg z-[1000] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="showMainApp()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üìä HR-—Ä–µ–∂–∏–º</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–¥–µ–ª–µ -->
                    <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white rounded-nb p-4 shadow-nb-strong">
                        <h3 class="text-base leading-relaxed font-bold mb-2">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h3>
                        <p class="m-0 text-white/90 text-sm leading-relaxed">
                            –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel
                        </p>
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –æ—Ç—á–µ—Ç–∞ -->
                <div class="grid gap-3 justify-items-center">
                    <button onclick="showHrPeriodModal('absences')" class="h-[60px] w-full flex flex-col items-start justify-center gap-1 px-5 border-none rounded-nb bg-gradient-to-r from-emerald-600 to-teal-600 text-white text-left cursor-pointer transition-all duration-200 active:scale-[0.97] hover:from-emerald-700 hover:to-teal-700 shadow-nb">
                        <div class="flex items-center gap-2 w-full">
                            <span class="text-xl">üèñÔ∏è</span>
                            <span class="text-[16px] font-bold">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–π</span>
                        </div>
                        <span class="text-[12px] text-white/80 ml-7">–û—Ç–ø—É—Å–∫–∞ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ –¥–∞—Ç–∞–º</span>
                    </button>
                    
                    <button onclick="showHrPeriodModal('crocotime')" class="h-[60px] w-full flex flex-col items-start justify-center gap-1 px-5 border-none rounded-nb bg-gradient-to-r from-amber-600 to-orange-600 text-white text-left cursor-pointer transition-all duration-200 active:scale-[0.97] hover:from-amber-700 hover:to-orange-700 shadow-nb">
                        <div class="flex items-center gap-2 w-full">
                            <span class="text-xl">‚è±Ô∏è</span>
                            <span class="text-[16px] font-bold">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Crocotime</span>
                        </div>
                        <span class="text-[12px] text-white/80 ml-7">–£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
                    </button>
                    
                    <button onclick="showHrPeriodModal('sick_leaves')" class="h-[60px] w-full flex flex-col items-start justify-center gap-1 px-5 border-none rounded-nb bg-gradient-to-r from-purple-600 to-violet-600 text-white text-left cursor-pointer transition-all duration-200 active:scale-[0.97] hover:from-purple-700 hover:to-violet-700 shadow-nb">
                        <div class="flex items-center gap-2 w-full">
                            <span class="text-xl">üè•</span>
                            <span class="text-[16px] font-bold">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≠–õ–ù</span>
                        </div>
                        <span class="text-[12px] text-white/80 ml-7">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –ª–∏—Å—Ç–∫–∏ –Ω–µ—Ç—Ä—É–¥–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- HR Period Selection Modal -->
        <div id="hr-period-modal" class="fixed inset-0 bg-nb-bg z-[1001] overflow-y-auto" style="display: none;">
            <div class="max-w-[440px] mx-auto px-nb-pad py-nb-pad box-border min-h-screen">
                <!-- Header -->
                <header class="flex items-center mb-5">
                    <button onclick="closeHrPeriodModal()" class="bg-transparent border-none text-nb-ink text-2xl p-2 cursor-pointer rounded-nb transition-all duration-200 flex items-center justify-center w-10 h-10 hover:bg-black/5 active:bg-black/10 active:scale-95">‚Üê</button>
                    <div class="flex-1 text-center">
                        <div class="font-bold text-[17px] m-0">üìÖ –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞</div>
                    </div>
                    <div class="w-10"></div>
                </header>

                <div class="grid gap-2.5 mb-5">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="bg-gradient-to-br from-indigo-600 to-blue-600 text-white rounded-nb p-4 shadow-nb">
                        <h3 class="text-base leading-relaxed font-bold mb-2">üìä <span id="hr-report-title">–û—Ç—á–µ—Ç</span></h3>
                        <p class="m-0 text-white/90 text-sm">
                            –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        </p>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ -->
                    <div class="bg-nb-graphite text-slate-50 rounded-nb p-4 shadow-nb">
                        <h3 class="text-sm font-extrabold tracking-wide mb-3">–ü–µ—Ä–∏–æ–¥ –≤—ã–≥—Ä—É–∑–∫–∏</h3>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                            <input type="date" id="hr-date-from" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold">
                        </div>

                        <div class="mb-4">
                            <label class="block mb-2 text-slate-300 text-[15px] font-bold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                            <input type="date" id="hr-date-to" 
                                   class="w-full p-3 rounded-nb border border-stone-400 bg-stone-400 text-white text-[15px] font-bold">
                        </div>
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ -->
                <div class="grid gap-3 justify-items-center">
                    <button onclick="generateHrReport()" class="h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-gradient-to-r from-green-600 to-emerald-600 text-white text-[16px] font-bold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:from-green-700 hover:to-emerald-700 shadow-nb-strong">
                        <span>üì•</span>
                        <span>–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Web App
        tg.ready();
        tg.expand();
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
        document.body.style.backgroundColor = tg.themeParams.bg_color || '#667eea';

        async function showAdminMenuModal() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.getElementById('app').style.display = 'none';
                document.getElementById('employees-management-modal').style.display = 'none';
                document.getElementById('issues-management-modal').style.display = 'none';
                document.getElementById('broadcast-modal').style.display = 'none';
                document.getElementById('messaging-menu-modal').style.display = 'none';
                document.getElementById('employee-message-modal').style.display = 'none';
                document.getElementById('send-employee-message-modal').style.display = 'none';
                document.getElementById('add-employee-modal').style.display = 'none';
                document.getElementById('edit-employee-modal').style.display = 'none';
                document.getElementById('hr-menu-modal').style.display = 'none';
                document.getElementById('hr-period-modal').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–º–µ–Ω—é
                document.getElementById('admin-menu-modal').style.display = 'block';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadAdminStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–º–µ–Ω—é');
            }
        }
        
        // üìä HR-–†–ï–ñ–ò–ú: –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HR-–º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        let currentHrReportType = null;
        
        async function showHrMenuModal() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.getElementById('app').style.display = 'none';
                document.getElementById('hr-period-modal').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º HR-–º–µ–Ω—é
                document.getElementById('hr-menu-modal').style.display = 'block';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ HR-–º–µ–Ω—é');
            }
        }
        
        function showHrPeriodModal(reportType) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
            currentHrReportType = reportType;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titleEl = document.getElementById('hr-report-title');
            const titles = {
                'absences': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–π',
                'crocotime': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Crocotime',
                'sick_leaves': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≠–õ–ù'
            };
            if (titleEl) {
                titleEl.textContent = titles[reportType] || '–û—Ç—á–µ—Ç';
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∫–∞–∫ "–î–æ"
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('hr-date-to').value = today;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥ –∫–∞–∫ "–û—Ç"
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            document.getElementById('hr-date-from').value = monthAgo.toISOString().split('T')[0];
            
            // –°–∫—Ä—ã–≤–∞–µ–º HR-–º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
            document.getElementById('hr-menu-modal').style.display = 'none';
            document.getElementById('hr-period-modal').style.display = 'block';
        }
        
        function closeHrPeriodModal() {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ HR-–º–µ–Ω—é
            document.getElementById('hr-period-modal').style.display = 'none';
            document.getElementById('hr-menu-modal').style.display = 'block';
        }
        
        async function generateHrReport() {
            try {
                const dateFrom = document.getElementById('hr-date-from').value;
                const dateTo = document.getElementById('hr-date-to').value;
                
                if (!dateFrom || !dateTo) {
                    tg.showAlert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥');
                    return;
                }
                
                if (dateFrom > dateTo) {
                    tg.showAlert('‚ö†Ô∏è –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                tg.showAlert('üìä –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram...');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ backend
                const response = await fetch(`http://localhost:5000/api/hr/${currentHrReportType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        date_from: dateFrom,
                        date_to: dateTo
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert('‚úÖ ' + result.message);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                    showMainApp();
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', error);
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞');
            }
        }
        
        async function loadAdminStats() {
            try {
                const response = await fetch(`http://localhost:5000/api/admin/stats?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                }

                const data = await response.json();
                const stats = data.stats;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const now = new Date();
                const timeString = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('stats-update-time').textContent = timeString;
                
                const statsContent = document.getElementById('admin-stats-content');
                statsContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
                        <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.15); border-radius: var(--radius); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div style="font-size: 28px; font-weight: bold; color: #10b981;">${stats.total_employees}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${stats.active_employees || stats.total_employees}</div>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(245, 158, 11, 0.15); border-radius: var(--radius); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <div style="font-size: 28px; font-weight: bold; color: #f59e0b;">${stats.active_issues}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">–°–µ–≥–æ–¥–Ω—è: ${stats.issues_today || 0}</div>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(59, 130, 246, 0.15); border-radius: var(--radius); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <div style="font-size: 28px; font-weight: bold; color: #3b82f6;">${stats.issues_this_week}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–û–±—Ä–∞—â–µ–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">–†–µ—à–µ–Ω–æ: ${stats.resolved_issues_week || 0}</div>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(239, 68, 68, 0.15); border-radius: var(--radius); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <div style="font-size: 28px; font-weight: bold; color: #ef4444;">${stats.current_sick_leaves}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">–°–µ–π—á–∞—Å</div>
                        </div>
                        
                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
                        <div style="text-align: center; padding: 15px; background: rgba(139, 92, 246, 0.15); border-radius: var(--radius); border: 1px solid rgba(139, 92, 246, 0.3);">
                            <div style="font-size: 28px; font-weight: bold; color: #8b5cf6;">${stats.users_with_bot || 0}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">${Math.round((stats.users_with_bot || 0)/(stats.total_employees || 1)*100)}% –æ—Ç –≤—Å–µ—Ö</div>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(168, 85, 247, 0.15); border-radius: var(--radius); border: 1px solid rgba(168, 85, 247, 0.3);">
                            <div style="font-size: 20px; font-weight: bold; color: #a855f7;">${(stats.technical_issues_month || 0)}/${(stats.personal_issues_month || 0)}</div>
                            <div style="font-size: 14px; color: var(--text); font-weight: 500; margin-top: 4px;">–¢–µ—Ö./–õ–∏—á–Ω. –∑–∞ –º–µ—Å—è—Ü</div>
                            <div style="font-size: 11px; color: var(--muted); margin-top: 2px;">–í—Å–µ–≥–æ: ${(stats.technical_issues_month || 0) + (stats.personal_issues_month || 0)}</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('admin-stats-content').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #ef4444;">
                        <div style="font-size: 16px;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>
                        <div style="font-size: 12px; margin-top: 8px; color: var(--muted);">${error.message}</div>
                        <button onclick="loadAdminStats()" style="margin-top: 10px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; border-radius: var(--radius); padding: 8px 16px; font-size: 12px; cursor: pointer;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                `;
                document.getElementById('stats-update-time').textContent = '–æ—à–∏–±–∫–∞';
            }
        }
        
        async function showEmployeesManagement() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.getElementById('admin-menu-modal').style.display = 'none';
                document.getElementById('add-employee-modal').style.display = 'none';
                document.getElementById('edit-employee-modal').style.display = 'none';
                document.getElementById('issues-management-modal').style.display = 'none';
                document.getElementById('broadcast-modal').style.display = 'none';
                document.getElementById('messaging-menu-modal').style.display = 'none';
                document.getElementById('employee-message-modal').style.display = 'none';
                document.getElementById('send-employee-message-modal').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
                document.getElementById('employees-management-modal').style.display = 'block';
                await loadEmployeesList();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
            }
        }
        
        async function loadEmployeesList() {
            try {
                const response = await fetch(`http://localhost:5000/api/admin/employees?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
                }

                const data = await response.json();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
                allEmployees = data.employees;
                filteredEmployees = [...allEmployees];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateEmployeesStats(allEmployees);
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                document.getElementById('employee-search').value = '';
                
                displayEmployeesList(filteredEmployees);
                updateSearchResultsCount();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('employees-list').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>';
            }
        }
        
        function displayEmployeesList(employees) {
            const container = document.getElementById('employees-list');
            if (!employees || employees.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            container.innerHTML = '';
            employees.forEach(emp => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏ —Å—Ç–∏–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
                let bgGradient, statusIcon, statusText, statusBadgeColor;
                
                if (emp.is_blocked) {
                    bgGradient = 'linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(248, 113, 113, 0.15) 100%)';
                    statusIcon = 'üî¥';
                    statusText = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                    statusBadgeColor = 'background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);';
                } else {
                    bgGradient = 'linear-gradient(135deg, rgba(17, 153, 142, 0.15) 0%, rgba(56, 239, 125, 0.15) 100%)';
                    statusIcon = 'üü¢';
                    statusText = '–ê–∫—Ç–∏–≤–µ–Ω';
                    statusBadgeColor = 'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);';
                }
                
                // –ë–µ–π–¥–∂ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                const adminBadge = emp.is_admin ? 
                    '<span style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); color: white; padding: 3px 10px; border-radius: 12px; font-size: 10px; margin-left: 8px; font-weight: bold; box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);">‚≠ê –ê–î–ú–ò–ù</span>' : '';
                
                // –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
                const botStatus = emp.chat_id ? '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : '‚ö†Ô∏è –ù–µ –≤ –±–æ—Ç–µ';
                const botStatusColor = emp.chat_id ? '#10b981' : '#f59e0b';
                const botBadgeGradient = emp.chat_id ? 
                    'background: linear-gradient(135deg, #10b981 0%, #34d399 100%);' : 
                    'background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);';
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Ä–æ–¥–µ –∏ —Ä–µ–∂–∏–º–µ —Ä–∞–±–æ—Ç—ã
                const city = emp.city || '–ù–µ —É–∫–∞–∑–∞–Ω';
                const workMode = emp.default_work_mode || 'office';
                const workModeText = workMode === 'office' ? 'üè¢ –û—Ñ–∏—Å–Ω—ã–π' : workMode === 'remote_only' ? 'üè° –£–¥–∞–ª–µ–Ω–Ω—ã–π' : 'üíº –°–º–µ—à–∞–Ω–Ω—ã–π';
                
                const empDiv = document.createElement('div');
                empDiv.style.cssText = `
                    background: ${bgGradient};
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 12px;
                    padding: 16px;
                    margin-bottom: 12px;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                    cursor: pointer;
                    width: 100%;
                    box-sizing: border-box;
                `;
                
                empDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;">
                            <span style="font-size: 28px; flex-shrink: 0;">üë§</span>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: bold; font-size: 15px; color: white; line-height: 1.3; display: flex; align-items: center; flex-wrap: wrap; gap: 4px;">
                                    <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${emp.first_name} ${emp.last_name}</span>
                                    ${adminBadge}
                            </div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 3px;">
                                    üìû ${emp.phone}
                        </div>
                        </div>
                    </div>
                        <div style="${statusBadgeColor} padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; color: white; box-shadow: 0 2px 6px rgba(0,0,0,0.2); white-space: nowrap; flex-shrink: 0;">
                            ${statusIcon} ${statusText}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
                        <div style="padding: 6px 12px; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border-radius: 8px; display: inline-flex; align-items: center; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);">
                            <span style="font-size: 11px; color: white; font-weight: bold;">üèôÔ∏è ${city}</span>
                        </div>
                        <div style="padding: 6px 12px; ${botBadgeGradient} border-radius: 8px; display: inline-flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.15);">
                            <span style="font-size: 11px; color: white; font-weight: bold;">${botStatus}</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 12px; padding: 8px 12px; background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); border-radius: 8px; display: inline-block; box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);">
                        <span style="font-size: 12px; color: white; font-weight: bold;">${workModeText}</span>
                    </div>
                    
                    <div style="display: flex; gap: 8px; width: 100%; margin-top: 12px;">
                        <button onclick="toggleEmployeeBlock('${emp.phone}', ${!emp.is_blocked})" 
                                style="padding: 8px 12px; border: none; border-radius: 10px; color: white; font-size: 12px; cursor: pointer; font-weight: bold; flex: 1; transition: all 0.2s; box-shadow: 0 2px 6px rgba(0,0,0,0.2); ${emp.is_blocked ? 'background: linear-gradient(135deg, #10b981 0%, #34d399 100%);' : 'background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);'}">
                            ${emp.is_blocked ? '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : 'üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 8px; width: 100%; margin-top: 8px;">
                        <button onclick="editEmployee('${emp.phone}', '${emp.first_name}', '${emp.last_name}', ${emp.is_admin}, '${city}', '${workMode}')" 
                                style="padding: 8px 12px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); border: none; border-radius: 10px; color: white; font-size: 12px; cursor: pointer; font-weight: bold; flex: 1; transition: all 0.2s; box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button onclick="deleteEmployee('${emp.phone}', '${emp.first_name}', '${emp.last_name}')" 
                                style="padding: 8px 12px; background: linear-gradient(135deg, #ef4444 0%, #f87171 100%); border: none; border-radius: 10px; color: white; font-size: 12px; cursor: pointer; font-weight: bold; flex: 1; transition: all 0.2s; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                empDiv.addEventListener('mouseenter', () => {
                    empDiv.style.transform = 'translateY(-2px)';
                    empDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
                });
                empDiv.addEventListener('mouseleave', () => {
                    empDiv.style.transform = 'translateY(0)';
                    empDiv.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.15)';
                });
                
                container.appendChild(empDiv);
            });
        }
        
        function updateEmployeesStats(employees) {
            const total = employees.length;
            const active = employees.filter(emp => !emp.is_blocked).length;
            const blocked = employees.filter(emp => emp.is_blocked).length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
            const totalElement = document.getElementById('total-employees-count');
            const activeElement = document.getElementById('active-employees-count');
            const blockedElement = document.getElementById('blocked-employees-count');
            
            if (totalElement) totalElement.textContent = total;
            if (activeElement) activeElement.textContent = active;
            if (blockedElement) blockedElement.textContent = blocked;
        }
        
        function filterEmployees() {
            const searchTerm = document.getElementById('employee-search').value.toLowerCase();
            const statusFilter = document.getElementById('employee-status-filter').value;
            
            filteredEmployees = allEmployees.filter(emp => {
                // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É
                const matchesSearch = !searchTerm || 
                    emp.first_name.toLowerCase().includes(searchTerm) ||
                    emp.last_name.toLowerCase().includes(searchTerm) ||
                    emp.phone.includes(searchTerm);
                
                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                let matchesStatus = true;
                if (statusFilter === 'active') {
                    matchesStatus = !emp.is_blocked;
                } else if (statusFilter === 'blocked') {
                    matchesStatus = emp.is_blocked;
                } else if (statusFilter === 'admin') {
                    matchesStatus = emp.is_admin;
                }
                
                return matchesSearch && matchesStatus;
            });
            
            displayEmployeesList(filteredEmployees);
            updateSearchResultsCount();
        }
        
        function updateSearchResultsCount() {
            const total = allEmployees ? allEmployees.length : 0;
            const filtered = filteredEmployees ? filteredEmployees.length : 0;
            const countElement = document.getElementById('search-results-count');
            
            if (filtered === total) {
                countElement.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${filtered} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`;
            } else {
                countElement.textContent = `–ù–∞–π–¥–µ–Ω–æ ${filtered} –∏–∑ ${total} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`;
            }
        }
        
        async function toggleEmployeeBlock(phone, isBlocked) {
            try {
                const response = await fetch('http://localhost:5000/api/admin/employee/block', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        employee_phone: phone,
                        is_blocked: isBlocked
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                    await loadEmployeesList(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
            }
        }
        
        async function showIssuesManagement() {
            console.log('showIssuesManagement –≤—ã–∑–≤–∞–Ω–∞');
            try {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
                stopDialogAutoRefresh();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.getElementById('admin-menu-modal').style.display = 'none';
                document.getElementById('employees-management-modal').style.display = 'none';
                document.getElementById('broadcast-modal').style.display = 'none';
                document.getElementById('messaging-menu-modal').style.display = 'none';
                document.getElementById('employee-message-modal').style.display = 'none';
                document.getElementById('send-employee-message-modal').style.display = 'none';
                document.getElementById('issue-dialog-modal').style.display = 'none';
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞
                const responseInput = document.getElementById('admin-response-input');
                if (responseInput) {
                    responseInput.value = '';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏
                document.getElementById('issues-management-modal').style.display = 'block';
                console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ, –≤—ã–∑—ã–≤–∞–µ–º loadIssuesList');
                
                // –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
                if (!issuesListCache) {
                    await loadIssuesList();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π');
            }
        }
        
        async function loadIssuesList(forceReload = false) {
            const container = document.getElementById('issues-list');
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
            if (issuesListCache && !forceReload) {
                displayCachedIssuesList();
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ä–∞–∑—É
            container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...</div>';
            
            try {
                const response = await fetch(`http://localhost:5000/api/admin/issues/all?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π');
                }

                const data = await response.json();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                issuesListCache = data.issues;
                allIssues = [...issuesListCache];
                filteredIssues = [...allIssues];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateIssuesStats(allIssues);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º
                displayIssuesList(filteredIssues);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤ loadIssuesList:', error);
                document.getElementById('issues-list').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π</div>';
            }
        }
        
        function updateIssuesStats(issues) {
            const active = issues.filter(issue => issue.status !== 'closed').length;
            const closed = issues.filter(issue => issue.status === 'closed').length;
            const technical = issues.filter(issue => issue.type === 'technical').length;
            const personal = issues.filter(issue => issue.type === 'personal').length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
            const activeElement = document.getElementById('active-issues-count');
            const closedElement = document.getElementById('closed-issues-count');
            const technicalElement = document.getElementById('technical-issues-count');
            const personalElement = document.getElementById('personal-issues-count');
            
            if (activeElement) activeElement.textContent = active;
            if (closedElement) closedElement.textContent = closed;
            if (technicalElement) technicalElement.textContent = technical;
            if (personalElement) personalElement.textContent = personal;
        }
        
        function filterIssues() {
            const searchTerm = document.getElementById('issues-search').value.toLowerCase();
            const statusFilter = document.getElementById('issues-status-filter').value;
            const typeFilter = document.getElementById('issues-type-filter').value;
            
            filteredIssues = allIssues.filter(issue => {
                // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É
                const matchesSearch = !searchTerm || 
                    issue.description.toLowerCase().includes(searchTerm) ||
                    issue.employee_name.toLowerCase().includes(searchTerm) ||
                    (issue.pseudonym && issue.pseudonym.toLowerCase().includes(searchTerm));
                
                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                let matchesStatus = true;
                if (statusFilter === 'open' || statusFilter === 'active') {
                    matchesStatus = issue.status === 'active';
                } else if (statusFilter === 'in_progress') {
                    matchesStatus = issue.status === 'in_progress';
                } else if (statusFilter === 'closed') {
                    matchesStatus = issue.status === 'closed';
                }
                
                // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
                let matchesType = true;
                if (typeFilter === 'technical') {
                    matchesType = issue.type === 'technical';
                } else if (typeFilter === 'personal') {
                    matchesType = issue.type === 'personal';
                }
                
                return matchesSearch && matchesStatus && matchesType;
            });
            
            displayIssuesList(filteredIssues);
            updateIssuesResultsCount();
        }
        
        function updateIssuesResultsCount() {
            const total = allIssues ? allIssues.length : 0;
            const filtered = filteredIssues ? filteredIssues.length : 0;
            const countElement = document.getElementById('issues-results-count');
            
            if (filtered === total) {
                countElement.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${filtered} –æ–±—Ä–∞—â–µ–Ω–∏–π`;
            } else {
                countElement.textContent = `–ù–∞–π–¥–µ–Ω–æ ${filtered} –∏–∑ ${total} –æ–±—Ä–∞—â–µ–Ω–∏–π`;
            }
        }
        
        function displayIssuesList(issues) {
            const container = document.getElementById('issues-list');
            
            if (!issues || issues.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">–û–±—Ä–∞—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = '';
            issues.forEach(issue => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏ —Å—Ç–∏–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
                let bgGradient, statusIcon, statusText, statusBadgeColor;
                
                if (issue.status === 'active') {
                    bgGradient = 'linear-gradient(135deg, rgba(17, 153, 142, 0.15) 0%, rgba(56, 239, 125, 0.15) 100%)';
                    statusIcon = 'üü¢';
                    statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);';
                } else if (issue.status === 'in_progress') {
                    bgGradient = 'linear-gradient(135deg, rgba(255, 165, 2, 0.15) 0%, rgba(255, 193, 7, 0.15) 100%)';
                    statusIcon = 'üü†';
                    statusText = '–í —Ä–∞–±–æ—Ç–µ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #ffa502 0%, #ffc107 100%);';
                } else if (issue.status === 'resolved') {
                    bgGradient = 'linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(74, 222, 128, 0.15) 100%)';
                    statusIcon = '‚úÖ';
                    statusText = '–†–µ—à–µ–Ω–æ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #22c55e 0%, #4ade80 100%);';
                } else {
                    bgGradient = 'linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%)';
                    statusIcon = 'üî¥';
                    statusText = '–ó–∞–∫—Ä—ã—Ç–æ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
                }
                
                const typeIcon = issue.type === 'personal' ? 'üíî' : 'üñ•Ô∏è';
                const typeText = issue.type === 'personal' ? '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                const anonymityText = issue.is_anonymous ? ` (${issue.pseudonym || '–ê–Ω–æ–Ω–∏–º–Ω–æ'})` : '';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
                let buttonsHtml = '';
                if (issue.status === 'closed') {
                    buttonsHtml = `
                        <button onclick="openIssueDialog(${issue.id})" 
                                style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; color: white; font-size: 13px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3); transition: all 0.2s;">
                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                    `;
                } else {
                    buttonsHtml = `
                        <button onclick="openIssueDialog(${issue.id})" 
                                style="padding: 8px 16px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border: none; border-radius: 10px; color: white; font-size: 13px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 6px rgba(56, 239, 125, 0.3); margin-right: 8px; transition: all 0.2s;">
                            üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å
                        </button>
                        <button onclick="closeIssue(${issue.id})" 
                                style="padding: 8px 16px; background: linear-gradient(135deg, #ef4444 0%, #f87171 100%); border: none; border-radius: 10px; color: white; font-size: 13px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3); transition: all 0.2s;">
                            ‚úÖ –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    `;
                }

                const issueDiv = document.createElement('div');
                issueDiv.style.cssText = `
                    background: ${bgGradient};
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 12px;
                    padding: 16px;
                    margin-bottom: 12px;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                    cursor: pointer;
                `;

                issueDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">${typeIcon}</span>
                        <div>
                                <div style="font-weight: bold; font-size: 14px; color: white;">
                                    ${typeText}${anonymityText}
                            </div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 2px;">
                                    –û–±—Ä–∞—â–µ–Ω–∏–µ #${issue.id}
                            </div>
                                </div>
                        </div>
                        <div style="${statusBadgeColor} padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; color: white; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">
                            ${statusIcon} ${statusText}
                        </div>
                    </div>
                    
                    <div style="font-size: 13px; color: rgba(255,255,255,0.95); margin-bottom: 12px; line-height: 1.5; background: rgba(0,0,0,0.15); padding: 10px; border-radius: 8px;">
                        ${issue.description}
                    </div>
                    
                    <div style="font-size: 11px; color: rgba(255,255,255,0.7); margin-bottom: 12px;">
                        üë§ ${issue.employee_name} ‚Ä¢ üïê ${new Date(issue.created_at).toLocaleString('ru-RU', { 
                            day: '2-digit', 
                            month: '2-digit', 
                            year: 'numeric', 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        })}
                        ${issue.response_count > 0 ? ` ‚Ä¢ üí¨ ${issue.response_count} ${issue.response_count === 1 ? '–æ—Ç–≤–µ—Ç' : '–æ—Ç–≤–µ—Ç–æ–≤'}` : ''}
                    </div>
                    
                    ${issue.last_response_preview ? `
                        <div style="margin-bottom: 12px; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; border-left: 3px solid rgba(255, 255, 255, 0.4);">
                            <div style="font-size: 10px; color: rgba(255, 255, 255, 0.6); margin-bottom: 4px; font-weight: bold;">–ü–û–°–õ–ï–î–ù–ò–ô –û–¢–í–ï–¢:</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.95); line-height: 1.4;">${issue.last_response_preview}</div>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${buttonsHtml}
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                issueDiv.addEventListener('mouseenter', () => {
                    issueDiv.style.transform = 'translateY(-2px)';
                    issueDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
                });
                issueDiv.addEventListener('mouseleave', () => {
                    issueDiv.style.transform = 'translateY(0)';
                    issueDiv.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.15)';
                });
                
                container.appendChild(issueDiv);
            });
        }
        
        let currentIssueId = null;
        let issuesListCache = null;
        
        async function openIssueDialog(issueId) {
            try {
                currentIssueId = issueId;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ–∫–Ω–∞
                document.getElementById('app').style.display = 'none';
                document.getElementById('issues-management-modal').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∏–∞–ª–æ–≥–∞ —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º
                document.getElementById('issue-dialog-modal').style.display = 'block';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
                await loadIssueDialog(issueId);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
                startDialogAutoRefresh();
                
                // –û—Ç–º–µ—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
                await markResponsesAsRead(issueId);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º');
            }
        }
        
        async function loadIssueDialog(issueId) {
            try {
                const container = document.getElementById('issue-dialog-content');
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞...</div>';
                
                const response = await fetch(`http://localhost:5000/api/admin/issue/${issueId}/dialog?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞');
                }

                const data = await response.json();
                displayIssueDialog(data);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É–º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∞–¥–º–∏–Ω—Å–∫–∏–π –¥–∏–∞–ª–æ–≥)
                adminDialogMessagesCount = data.responses ? data.responses.length : 0;
                adminLastDialogData = data;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞:', error);
                document.getElementById('issue-dialog-content').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞</div>';
            }
        }
        
        function displayIssueDialog(data) {
            const container = document.getElementById('issue-dialog-content');
            const issue = data.issue;
            const responses = data.responses || [];
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏
            const typeIcon = issue.issue_type === 'personal' ? 'üíî' : 'üñ•';
            const typeText = issue.issue_type === 'personal' ? '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
            const anonymityText = issue.is_anonymous ? ` (${issue.pseudonym || '–ê–Ω–æ–Ω–∏–º–Ω–æ'})` : '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            let statusIcon = 'üü°';
            let statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
            let statusColor = '#ffa500';
            if (issue.status === 'closed') {
                statusIcon = 'üî¥';
                statusText = '–ó–∞–∫—Ä—ã—Ç–æ';
                statusColor = '#ff4757';
            } else if (issue.status === 'resolved') {
                statusIcon = 'üü¢';
                statusText = '–†–µ—à–µ–Ω–æ';
                statusColor = '#2ed573';
            }
            
            let html = '';
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏
            html += '<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: var(--radius); margin-bottom: 15px;">';
            html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
            html += '<h3 style="margin: 0; font-size: 16px; line-height: 1.4;">' + typeIcon + ' –û–±—Ä–∞—â–µ–Ω–∏–µ #' + issue.id + anonymityText + '</h3>';
            html += '<div style="font-size: 12px; color: ' + statusColor + '; font-weight: 600;">' + statusIcon + ' ' + statusText + '</div>';
            html += '</div>';
            html += '<div style="font-size: 13px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">' + typeText + '</div>';
            html += '<div style="font-size: 14px; margin-bottom: 12px; line-height: 1.4;">' + issue.description + '</div>';
            html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 4px;">üë§ –û—Ç: ' + issue.employee_name + '</div>';
            html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6);">üïê –°–æ–∑–¥–∞–Ω–æ: ' + new Date(issue.created_at).toLocaleString('ru-RU') + '</div>';
            
            // –ï—Å–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞
            if (issue.status === 'closed') {
                html += '<div style="margin-top: 12px; padding: 10px; background: rgba(255, 71, 87, 0.2); border-radius: var(--radius); font-size: 12px; color: rgba(255,255,255,0.9);">';
                html += 'üîí –≠—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é, –Ω–æ –Ω–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–æ.';
                html += '</div>';
            }
            
            html += '</div>';
            
            // –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–≤–µ—Ç–æ–≤
            if (responses.length > 0) {
                html += '<div class="dialog-messages" style="margin-bottom: 15px;">';
                html += '<h3 style="font-size: 16px; line-height: 1.4; margin-bottom: 15px;">üí¨ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞</h3>';
                
                responses.forEach(response => {
                    const isAdminMessage = response.responder_phone === 'admin';
                    // –ê–¥–º–∏–Ω —Å–º–æ—Ç—Ä–∏—Ç —á–∞—Ç: –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Ç –∞–¥–º–∏–Ω–∞) - —Å–ø—Ä–∞–≤–∞, —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ - —Å–ª–µ–≤–∞
                    const messageStyle = isAdminMessage 
                        ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-left: auto; text-align: right; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);'
                        : 'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; margin-right: auto; text-align: left; box-shadow: 0 2px 8px rgba(56, 239, 125, 0.3);';
                    
                    html += '<div style="margin: 10px 0; padding: 12px 15px; border-radius: 12px; max-width: 80%; word-wrap: break-word; ' + messageStyle + '">';
                    html += '<div style="font-size: 14px; margin-bottom: 6px; line-height: 1.4;">' + response.response_text + '</div>';
                    html += '<div style="font-size: 11px; opacity: 0.8;">';
                    html += (isAdminMessage ? 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫') + ' ‚Ä¢ ' + new Date(response.created_at).toLocaleString('ru-RU');
                    html += '</div>';
                    html += '</div>';
                });
                
                html += '</div>';
            } else {
                html += '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px; font-style: italic;">';
                html += 'üí≠ –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ!';
                html += '</div>';
            }
            
            container.innerHTML = html;
            
            // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è
            const inputContainer = document.querySelector('#issue-dialog-modal div[style*="position: fixed"]');
            if (inputContainer) {
                const input = document.getElementById('admin-response-input');
                const button = inputContainer.querySelector('button');
                
                if (issue.status === 'closed') {
                    // –î–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –¥–µ–ª–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    inputContainer.style.opacity = '0.6';
                    if (input) {
                        input.placeholder = '–û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ - –æ—Ç–≤–µ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã';
                        input.style.background = 'rgba(255, 71, 87, 0.2)';
                        input.disabled = true;
                    }
                    if (button) {
                        button.style.background = '#ff4757';
                        button.innerHTML = 'üîí –ó–∞–∫—Ä—ã—Ç–æ';
                        button.disabled = true;
                    }
                } else {
                    // –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π –≤–∏–¥
                    inputContainer.style.opacity = '1';
                    if (input) {
                        input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...';
                        input.style.background = 'rgba(255,255,255,0.1)';
                        input.disabled = false;
                    }
                    if (button) {
                        button.style.background = 'var(--accent)';
                        button.innerHTML = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
                        button.disabled = false;
                    }
                }
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
            setTimeout(() => {
                const scrollableContainer = document.querySelector('#issue-dialog-modal .card');
                if (scrollableContainer) {
                    console.log('–ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–π –¥–∏–∞–ª–æ–≥ –≤–Ω–∏–∑');
                    scrollableContainer.scrollTop = scrollableContainer.scrollHeight;
                } else {
                    console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–∏–∞–ª–æ–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }, 100);
        }
        
        async function sendAdminResponse() {
            try {
                const input = document.getElementById('admin-response-input');
                const responseText = input.value.trim();
                
                if (!responseText) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞');
                    return;
                }
                
                const response = await fetch(`http://localhost:5000/api/admin/issue/${currentIssueId}/respond`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        response_text: responseText
                    })
                });

                if (!response.ok) {
                    if (response.status === 403) {
                        const errorData = await response.json();
                        if (errorData.error === 'Cannot respond to closed issue') {
                            tg.showAlert('–ù–µ–ª—å–∑—è –æ—Ç–≤–µ—á–∞—Ç—å –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ');
                            return;
                        }
                    }
                    throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞');
                }

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –¥–∏–∞–ª–æ–≥ –ª–æ–∫–∞–ª—å–Ω–æ
                addMessageToDialog(responseText, true, false);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∏–∑—É –¥–∏–∞–ª–æ–≥–∞ –ú–ì–ù–û–í–ï–ù–ù–û
                scrollToBottom(false, true);
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                input.value = '';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à —Å–ø–∏—Å–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π (—Ç–∞–∫ –∫–∞–∫ –¥–æ–±–∞–≤–∏–ª—Å—è –Ω–æ–≤—ã–π –æ—Ç–≤–µ—Ç)
                issuesListCache = null;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
                adminDialogMessagesCount++;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞');
            }
        }
        
        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendAdminResponse();
            }
        }
        
        async function closeIssue(issueId) {
            try {
                const response = await fetch(`http://localhost:5000/api/admin/issue/${issueId}/close`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                    issuesListCache = null;
                    await loadIssuesList(true); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–±—Ä–∞—â–µ–Ω–∏—è');
            }
        }
        
        async function sendStatsToChannel() {
            try {
                const response = await fetch('http://localhost:5000/api/admin/send-stats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
            }
        }
        
        function showMessagingMenu() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('admin-menu-modal').style.display = 'none';
            document.getElementById('employees-management-modal').style.display = 'none';
            document.getElementById('issues-management-modal').style.display = 'none';
            document.getElementById('broadcast-modal').style.display = 'none';
            document.getElementById('employee-message-modal').style.display = 'none';
            document.getElementById('send-employee-message-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('messaging-menu-modal').style.display = 'block';
        }
        
        function showBroadcastMessage() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('messaging-menu-modal').style.display = 'none';
            document.getElementById('employee-message-modal').style.display = 'none';
            document.getElementById('send-employee-message-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–∞—Å—Å—ã–ª–∫–∏
            document.getElementById('broadcast-modal').style.display = 'block';
            document.getElementById('broadcast-message').value = '';
            document.getElementById('broadcast-file').value = '';
            document.getElementById('broadcast-file-info').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ —Ñ–∞–π–ª–∞
            const broadcastFileButton = document.getElementById('broadcast-file-button');
            const broadcastFileButtonText = document.getElementById('broadcast-file-button-text');
            if (broadcastFileButton && broadcastFileButtonText) {
                broadcastFileButton.style.border = '2px dashed rgba(255, 255, 255, 0.3)';
                broadcastFileButton.style.background = 'rgba(255, 255, 255, 0.05)';
                broadcastFileButton.style.color = 'rgba(255, 255, 255, 0.7)';
                broadcastFileButtonText.textContent = '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª';
            }
        }
        
        async function showEmployeeMessageMenu() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.getElementById('messaging-menu-modal').style.display = 'none';
                document.getElementById('broadcast-modal').style.display = 'none';
                document.getElementById('send-employee-message-modal').style.display = 'none';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
                document.getElementById('employee-message-text').value = '';
                document.getElementById('employee-message-file').value = '';
                document.getElementById('employee-file-info').style.display = 'none';
                updateEmployeeFileInfo(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ —Ñ–∞–π–ª–∞
                selectedEmployeeForMessage = null;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                document.getElementById('employee-message-modal').style.display = 'block';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                await loadEmployeesForMessage();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
            }
        }
        
        async function sendBroadcastMessage() {
            try {
                const messageText = document.getElementById('broadcast-message').value.trim();
                const fileInput = document.getElementById('broadcast-file');
                const file = fileInput.files[0];
                
                if (!messageText && !file) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                    return;
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ FormData
                if (file) {
                    const formData = new FormData();
                    formData.append('initData', tg.initData);
                    formData.append('message', messageText || '');
                    formData.append('file', file);
                    formData.append('target', 'all');
                    
                    const response = await fetch('http://localhost:5000/api/admin/send-file', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        tg.showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º');
                        document.getElementById('broadcast-message').value = '';
                        fileInput.value = '';
                        updateBroadcastFileInfo(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
                        showAdminMenuModal();
                    } else {
                        tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                    }
                } else {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
                    const response = await fetch('http://localhost:5000/api/admin/broadcast', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            initData: tg.initData,
                            message: messageText
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        tg.showAlert(result.message);
                        document.getElementById('broadcast-message').value = '';
                        showAdminMenuModal();
                    } else {
                        tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }
        
        let allEmployeesForMessage = [];
        let filteredEmployeesForMessage = [];
        let selectedEmployeeForMessage = null;
        
        async function loadEmployeesForMessage() {
            try {
                const response = await fetch(`http://localhost:5000/api/admin/employees?initData=${encodeURIComponent(tg.initData)}`);
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
                
                const data = await response.json();
                allEmployeesForMessage = data.employees || [];
                filteredEmployeesForMessage = [...allEmployeesForMessage];
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                document.getElementById('employee-message-search').value = '';
                
                displayEmployeesForMessage(filteredEmployeesForMessage);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('employee-message-list').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>';
            }
        }
        
        function displayEmployeesForMessage(employees) {
            const container = document.getElementById('employee-message-list');
            if (!employees || employees.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            container.innerHTML = '';
            employees.forEach(emp => {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º phone –≤–º–µ—Å—Ç–æ chat_id)
                // if (!emp.chat_id) {
                //     return;
                // }
                
                const empDiv = document.createElement('div');
                empDiv.style.cssText = `
                    background: #8b5cf6;
                    border: 1px solid #7c3aed;
                    border-radius: var(--radius);
                    padding: 12px 14px;
                    margin-bottom: 12px;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
                    cursor: pointer;
                    width: 100%;
                    box-sizing: border-box;
                    max-width: 100%;
                `;
                
                const statusIcon = emp.is_blocked ? 'üî¥' : 'üü¢';
                const statusText = emp.is_blocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω';
                const adminBadge = emp.is_admin ? '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin-left: 8px;">–ê–î–ú–ò–ù</span>' : '';
                
                empDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <div style="flex: 1; min-width: 0; margin-right: 8px;">
                            <div style="font-size: 14px; font-weight: 600; color: white; margin-bottom: 2px; word-wrap: break-word;">
                                üë§ ${emp.first_name} ${emp.last_name}${adminBadge}
                            </div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.8); margin-bottom: 2px; word-wrap: break-word;">üìû ${emp.phone}</div>
                            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.7);">‚úÖ –í –±–æ—Ç–µ</div>
                        </div>
                        <div style="text-align: right; flex-shrink: 0;">
                            <div style="font-size: 11px; color: ${emp.is_blocked ? '#fca5a5' : '#a7f3d0'}; font-weight: 500;">${statusIcon} ${statusText}</div>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç
                empDiv.addEventListener('mouseenter', () => {
                    empDiv.style.borderColor = '#a855f7';
                    empDiv.style.transform = 'translateY(-1px)';
                    empDiv.style.boxShadow = '0 4px 12px rgba(139, 92, 246, 0.3)';
                });
                empDiv.addEventListener('mouseleave', () => {
                    empDiv.style.borderColor = '#7c3aed';
                    empDiv.style.transform = 'translateY(0)';
                    empDiv.style.boxShadow = '0 2px 8px rgba(139, 92, 246, 0.2)';
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                empDiv.addEventListener('click', () => {
                    selectEmployeeForMessage(emp);
                });
                
                container.appendChild(empDiv);
            });
        }
        
        function filterEmployeesForMessage() {
            const searchTerm = document.getElementById('employee-message-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredEmployeesForMessage = [...allEmployeesForMessage];
            } else {
                filteredEmployeesForMessage = allEmployeesForMessage.filter(emp => {
                    const fullName = `${emp.first_name} ${emp.last_name}`.toLowerCase();
                    const phone = emp.phone.toLowerCase();
                    
                    return fullName.includes(searchTerm) || 
                           emp.first_name.toLowerCase().includes(searchTerm) ||
                           emp.last_name.toLowerCase().includes(searchTerm) ||
                           phone.includes(searchTerm);
                });
            }
            
            displayEmployeesForMessage(filteredEmployeesForMessage);
        }
        
        function selectEmployeeForMessage(employee) {
            selectedEmployeeForMessage = employee;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            document.getElementById('employee-message-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('send-employee-message-modal').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
            document.getElementById('employee-message-title').textContent = `–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è ${employee.first_name} ${employee.last_name}`;
            document.getElementById('selected-employee-info').textContent = `${employee.first_name} ${employee.last_name} (${employee.phone})`;
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ–∞–π–ª–∞
            document.getElementById('employee-message-text').value = '';
            document.getElementById('employee-message-file').value = '';
            document.getElementById('employee-file-info').style.display = 'none';
            updateEmployeeFileInfo(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ —Ñ–∞–π–ª–∞
        }
        
        async function sendEmployeeMessage() {
            try {
                if (!selectedEmployeeForMessage) {
                    tg.showAlert('–ù–µ –≤—ã–±—Ä–∞–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫');
                    return;
                }
                
                const messageText = document.getElementById('employee-message-text').value.trim();
                const fileInput = document.getElementById('employee-message-file');
                const file = fileInput.files[0];
                
                if (!messageText && !file) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                    return;
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ FormData
                if (file) {
                    const formData = new FormData();
                    formData.append('initData', tg.initData);
                    formData.append('message', messageText || '');
                    formData.append('file', file);
                    formData.append('target', 'one');
                    formData.append('employee_phone', selectedEmployeeForMessage.phone);
                    
                    const response = await fetch('http://localhost:5000/api/admin/send-file', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        tg.showAlert(`–°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${selectedEmployeeForMessage.first_name} ${selectedEmployeeForMessage.last_name}`);
                        document.getElementById('employee-message-text').value = '';
                        fileInput.value = '';
                        document.getElementById('employee-file-info').style.display = 'none';
                        selectedEmployeeForMessage = null;
                        showAdminMenuModal();
                    } else {
                        tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                    }
                } else {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ broadcast API —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    const response = await fetch('http://localhost:5000/api/admin/broadcast', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            initData: tg.initData,
                            message: messageText,
                            target_employee_phone: selectedEmployeeForMessage.phone
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        tg.showAlert(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${selectedEmployeeForMessage.first_name} ${selectedEmployeeForMessage.last_name}`);
                        document.getElementById('employee-message-text').value = '';
                        selectedEmployeeForMessage = null;
                        showAdminMenuModal();
                    } else {
                        tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }
        
        function updateEmployeeFileInfo() {
            const fileInput = document.getElementById('employee-message-file');
            const fileInfo = document.getElementById('employee-file-info');
            const fileButton = document.getElementById('employee-file-button');
            const fileButtonText = document.getElementById('file-button-text');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                fileInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px;">
                        <span style="color: #10b981;">üìé</span>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 12px; color: #10b981; font-weight: 600; word-wrap: break-word;">${file.name}</div>
                            <div style="font-size: 11px; color: rgba(16, 185, 129, 0.8);">${fileSize} –ú–ë</div>
                        </div>
                        <button onclick="clearEmployeeFile()" style="background: none; border: none; color: rgba(255, 255, 255, 0.5); cursor: pointer; padding: 2px; font-size: 14px;">‚úï</button>
                    </div>
                `;
                fileInfo.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
                fileButton.style.border = '2px solid #10b981';
                fileButton.style.background = 'rgba(16, 185, 129, 0.1)';
                fileButton.style.color = '#10b981';
                fileButtonText.textContent = '–§–∞–π–ª –≤—ã–±—Ä–∞–Ω';
            } else {
                fileInfo.style.display = 'none';
                fileButton.style.border = '2px dashed rgba(255, 255, 255, 0.3)';
                fileButton.style.background = 'rgba(255, 255, 255, 0.05)';
                fileButton.style.color = 'rgba(255, 255, 255, 0.7)';
                fileButtonText.textContent = '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª';
            }
        }
        
        function clearEmployeeFile() {
            const fileInput = document.getElementById('employee-message-file');
            fileInput.value = '';
            updateEmployeeFileInfo();
        }
        
        function updateBroadcastFileInfo() {
            const fileInput = document.getElementById('broadcast-file');
            const fileInfo = document.getElementById('broadcast-file-info');
            const fileButton = document.getElementById('broadcast-file-button');
            const fileButtonText = document.getElementById('broadcast-file-button-text');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                fileInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px;">
                        <span style="color: #10b981;">üìé</span>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 12px; color: #10b981; font-weight: 600; word-wrap: break-word;">${file.name}</div>
                            <div style="font-size: 11px; color: rgba(16, 185, 129, 0.8);">${fileSize} –ú–ë</div>
                        </div>
                        <button onclick="clearBroadcastFile()" style="background: none; border: none; color: rgba(255, 255, 255, 0.5); cursor: pointer; padding: 2px; font-size: 14px;">‚úï</button>
                    </div>
                `;
                fileInfo.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
                fileButton.style.border = '2px solid #10b981';
                fileButton.style.background = 'rgba(16, 185, 129, 0.1)';
                fileButton.style.color = '#10b981';
                fileButtonText.textContent = '–§–∞–π–ª –≤—ã–±—Ä–∞–Ω';
            } else {
                fileInfo.style.display = 'none';
                fileButton.style.border = '2px dashed rgba(255, 255, 255, 0.3)';
                fileButton.style.background = 'rgba(255, 255, 255, 0.05)';
                fileButton.style.color = 'rgba(255, 255, 255, 0.7)';
                fileButtonText.textContent = '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª';
            }
        }
        
        function clearBroadcastFile() {
            const fileInput = document.getElementById('broadcast-file');
            fileInput.value = '';
            updateBroadcastFileInfo();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—è —Ñ–∞–π–ª–∞ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ –≤—Å–µ–º
            const broadcastFileInput = document.getElementById('broadcast-file');
            if (broadcastFileInput) {
                broadcastFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const infoDiv = document.getElementById('broadcast-file-info');
                    
                    if (file) {
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        infoDiv.innerHTML = `üìÑ ${file.name} (${fileSize} MB)`;
                        infoDiv.style.display = 'block';
                    } else {
                        infoDiv.style.display = 'none';
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—è —Ñ–∞–π–ª–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
            const employeeFileInput = document.getElementById('employee-message-file');
            if (employeeFileInput) {
                employeeFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const infoDiv = document.getElementById('employee-file-info');
                    
                    if (file) {
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        infoDiv.innerHTML = `üìÑ ${file.name} (${fileSize} MB)`;
                        infoDiv.style.display = 'block';
                    } else {
                        infoDiv.style.display = 'none';
                    }
                });
            }
        });
        
        function showAddEmployeeModal() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('employees-management-modal').style.display = 'none';
            document.getElementById('edit-employee-modal').style.display = 'none';
            document.getElementById('admin-menu-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('add-employee-modal').style.display = 'block';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('add-phone').value = '';
            document.getElementById('add-first-name').value = '';
            document.getElementById('add-last-name').value = '';
            document.getElementById('add-city').value = '';
            document.getElementById('add-work-mode').value = 'office';
            document.getElementById('add-is-admin').checked = false;
        }
        
        async function addEmployee() {
            try {
                const phoneNumber = document.getElementById('add-phone').value.trim();
                const firstName = document.getElementById('add-first-name').value.trim();
                const lastName = document.getElementById('add-last-name').value.trim();
                const city = document.getElementById('add-city').value.trim() || '–ù–µ —É–∫–∞–∑–∞–Ω';
                const defaultWorkMode = document.getElementById('add-work-mode').value;
                const isAdmin = document.getElementById('add-is-admin').checked;
                
                if (!phoneNumber || !firstName || !lastName) {
                    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                const response = await fetch('http://localhost:5000/api/admin/employee/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        phone_number: phoneNumber,
                        first_name: firstName,
                        last_name: lastName,
                        city: city,
                        default_work_mode: defaultWorkMode,
                        is_admin: isAdmin
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                    showEmployeesManagement(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
            }
        }
        
        function editEmployee(phone, firstName, lastName, isAdmin, city, defaultWorkMode) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            document.getElementById('employees-management-modal').style.display = 'none';
            document.getElementById('add-employee-modal').style.display = 'none';
            document.getElementById('admin-menu-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('edit-employee-modal').style.display = 'block';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
            document.getElementById('edit-phone').value = phone;
            document.getElementById('edit-first-name').value = firstName;
            document.getElementById('edit-last-name').value = lastName;
            document.getElementById('edit-city').value = city || '–ù–µ —É–∫–∞–∑–∞–Ω';
            document.getElementById('edit-work-mode').value = defaultWorkMode || 'office';
            document.getElementById('edit-is-admin').checked = isAdmin;
        }
        
        async function saveEmployeeChanges() {
            try {
                const phoneNumber = document.getElementById('edit-phone').value.trim();
                const firstName = document.getElementById('edit-first-name').value.trim();
                const lastName = document.getElementById('edit-last-name').value.trim();
                const city = document.getElementById('edit-city').value.trim() || '–ù–µ —É–∫–∞–∑–∞–Ω';
                const defaultWorkMode = document.getElementById('edit-work-mode').value;
                const isAdmin = document.getElementById('edit-is-admin').checked;
                
                if (!firstName || !lastName) {
                    tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                const response = await fetch('http://localhost:5000/api/admin/employee/edit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        phone_number: phoneNumber,
                        first_name: firstName,
                        last_name: lastName,
                        city: city,
                        default_work_mode: defaultWorkMode,
                        is_admin: isAdmin
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                    showEmployeesManagement(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π');
            }
        }
        
        async function deleteEmployee(phone, firstName, lastName) {
            try {
                // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${firstName} ${lastName}?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è, –±–æ–ª—å–Ω–∏—á–Ω—ã–µ, –æ–±—Ä–∞—â–µ–Ω–∏—è.`)) {
                    return;
                }
                
                const response = await fetch('http://localhost:5000/api/admin/employee/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        phone_number: phone
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    tg.showAlert(result.message);
                    await loadEmployeesList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
            }
        }
        
        function filterEmployees() {
            const searchTerm = document.getElementById('employee-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                filteredEmployees = [...allEmployees];
            } else {
                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏ –∏–ª–∏ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                filteredEmployees = allEmployees.filter(emp => {
                    const fullName = `${emp.first_name} ${emp.last_name}`.toLowerCase();
                    const phone = emp.phone.toLowerCase();
                    
                    return fullName.includes(searchTerm) || 
                           emp.first_name.toLowerCase().includes(searchTerm) ||
                           emp.last_name.toLowerCase().includes(searchTerm) ||
                           phone.includes(searchTerm);
                });
            }
            
            displayEmployeesList(filteredEmployees);
            updateSearchResultsCount();
        }
        
        function updateSearchResultsCount() {
            const searchTerm = document.getElementById('employee-search').value.trim();
            const countElement = document.getElementById('search-results-count');
            
            if (!searchTerm) {
                countElement.textContent = '';
                countElement.style.color = 'rgba(255,255,255,0.6)';
            } else {
                if (filteredEmployees.length === 0) {
                    countElement.textContent = '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                    countElement.style.color = 'rgba(255, 71, 87, 0.8)';
                } else if (filteredEmployees.length === 1) {
                    countElement.textContent = '–ù–∞–π–¥–µ–Ω 1 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫';
                    countElement.style.color = 'rgba(46, 213, 115, 0.8)';
                } else {
                    countElement.textContent = `–ù–∞–π–¥–µ–Ω–æ ${filteredEmployees.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`;
                    countElement.style.color = 'rgba(46, 213, 115, 0.8)';
                }
            }
        }
        
        async function loadUserAvatar() {
            try {
                const user = tg.initDataUnsafe?.user;
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user);
                console.log('–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ tg.initDataUnsafe:', tg.initDataUnsafe);
                console.log('tg.initData:', tg.initData);
                
                if (!user) {
                    console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    return;
                }
                
                const avatarEl = document.getElementById('avatar');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ photo_url –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç Telegram
                if (user.photo_url) {
                    console.log('–ù–∞–π–¥–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö Telegram:', user.photo_url);
                    avatarEl.innerHTML = `<img src="${user.photo_url}" alt="Avatar">`;
                    return;
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç photo_url, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ tg.initDataUnsafe
                const initData = tg.initDataUnsafe;
                if (initData && initData.user && initData.user.photo_url) {
                    console.log('–ù–∞–π–¥–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∞ –≤ initDataUnsafe:', initData.user.photo_url);
                    avatarEl.innerHTML = `<img src="${initData.user.photo_url}" alt="Avatar">`;
                    return;
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ Flask API
                console.log('–ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É —á–µ—Ä–µ–∑ API...');
                try {
                    const apiResponse = await fetch(`http://localhost:5000/api/user-avatar?user_id=${user.id}`, {
                        method: 'GET'
                    });
                    
                    console.log('–û—Ç–≤–µ—Ç API –∞–≤–∞—Ç–∞—Ä–∫–∏:', apiResponse.status);
                    
                    if (apiResponse.ok) {
                        const apiData = await apiResponse.json();
                        console.log('–î–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –æ—Ç API:', apiData);
                        
                        if (apiData.avatar_url) {
                            console.log('–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –æ—Ç API:', apiData.avatar_url);
                            avatarEl.innerHTML = `<img src="${apiData.avatar_url}" alt="Avatar">`;
                            return;
                        }
                    }
                } catch (apiError) {
                    console.log('–û—à–∏–±–∫–∞ API –∞–≤–∞—Ç–∞—Ä–∫–∏:', apiError);
                }
                
                // –ï—Å–ª–∏ API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –∫—Ä—É–≥ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                console.log('–ê–≤–∞—Ç–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –∫—Ä—É–≥');
                avatarEl.innerHTML = '';
                avatarEl.textContent = '';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –∫—Ä—É–≥
                const avatarEl = document.getElementById('avatar');
                avatarEl.innerHTML = '';
                avatarEl.textContent = '';
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ—Ç –±–µ–π–¥–∂ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        async function updateUnreadBadge() {
            try {
                const response = await fetch(`http://localhost:5000/api/my-issues?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞');
                    return;
                }
                
                const data = await response.json();
                
                if (!data.success || !data.issues) {
                    return;
                }
                
                // –°—á–∏—Ç–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è)
                const unreadCount = data.issues.filter(issue => 
                    issue.status === 'active' && issue.unread_count > 0
                ).length;
                
                const badge = document.getElementById('sos-unread-badge');
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
                
                console.log(`üîî –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π: ${unreadCount}`);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:', error);
            }
        }
        
        // üé® –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∑–∞—Å—Ç–∞–≤–∫–∏ —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function hideSplashScreen() {
            const splashScreen = document.getElementById('splash-screen');
            if (splashScreen) {
                splashScreen.classList.add('hidden');
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM —á–µ—Ä–µ–∑ 500ms (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏)
                setTimeout(() => {
                    splashScreen.remove();
                }, 500);
            }
        }
        
        async function loadUserData() {
            try {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º API –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const response = await fetch('http://localhost:5000/api/user-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData
                    })
                });

                // –õ–æ–≥–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                console.log(`üì° API Response Status: ${response.status}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–∞ –ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
                if (response.status === 401) {
                    console.log('üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                    try {
                        const errorData = await response.json();
                        console.log('üìÑ Error data:', errorData);
                        showAuthScreen(errorData.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
                        return;
                    } catch (jsonError) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –¥–ª—è 401:', jsonError);
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∏–º–µ–Ω–µ–º
                        showAuthScreen('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
                        return;
                    }
                }

                if (!response.ok) {
                    console.error(`‚ùå Response not OK: ${response.status}`);
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                const data = await response.json();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ
                currentUserData = data;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('name').textContent = data.user.first_name || 'Aleksei';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã)
                loadUserAvatar();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É "–°–µ–≥–æ–¥–Ω—è" —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î
                const todayStatusEl = document.getElementById('today-status');
                if (todayStatusEl && data.status && data.status.work_mode) {
                    todayStatusEl.textContent = data.status.work_mode;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–ø—É—Å–∫–µ
                const nextVacationEl = document.getElementById('next-vacation');
                if (nextVacationEl && data.vacation) {
                    if (data.vacation.is_coming_soon) {
                        nextVacationEl.textContent = data.vacation.message;
                    } else if (data.vacation.days_until) {
                        nextVacationEl.textContent = `${data.vacation.start_date} - ${data.vacation.end_date} (—á–µ—Ä–µ–∑ ${data.vacation.days_until} –¥–Ω.)`;
                    } else {
                        nextVacationEl.textContent = '–û—Ç–ø—É—Å–∫ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
                    }
                } else if (nextVacationEl) {
                    nextVacationEl.textContent = '–û—Ç–ø—É—Å–∫ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –¥–Ω—è
                const todayMessageEl = document.getElementById('today-message');
                if (todayMessageEl && data.daily_fact) {
                    todayMessageEl.textContent = data.daily_fact;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–æ–µ –º–µ–Ω—é, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                if (data.user.is_admin) {
                    const adminBtnEl = document.getElementById('admin-btn');
                    if (adminBtnEl) adminBtnEl.style.display = 'inline-flex';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º HR-—Ä–µ–∂–∏–º –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –ï–ª–µ–Ω—ã –ü–µ—Ä–º–∏—Ç–∏–Ω–æ–π
                const isHrUser = data.user.is_admin || 
                                (data.user.first_name === '–ï–ª–µ–Ω–∞' && data.user.last_name === '–ü–µ—Ä–º–∏—Ç–∏–Ω–∞');
                if (isHrUser) {
                    const hrBtnEl = document.getElementById('hr-btn');
                    if (hrBtnEl) hrBtnEl.style.display = 'inline-flex';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                updateUnreadBadge();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞—Å—Ç–∞–≤–∫—É —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
                hideSplashScreen();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞—Å—Ç–∞–≤–∫—É —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
                hideSplashScreen();
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('loading').style.display = 'none';
                
                // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
                if (error.message && error.message.includes('Failed to fetch')) {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost:5000');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
                document.getElementById('error').style.display = 'block';
            }
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
        let selectedMode = null;
        let selectedPeriod = null;
        let workModeOptions = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
        let absenceOptions = null;
        let selectedAbsenceDate = null;
        let selectedAbsenceTime = null;
        let customAbsenceDate = null;
        let customAbsenceStartTime = null;
        let customAbsenceEndTime = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è SOS
        let sosOptions = null;
        let selectedIssueType = null;
        let selectedAnonymity = null;
        let sosPseudonym = null;
        let sosDescription = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
        let sickLeaveOptions = null;
        let selectedLeaveType = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —á–∞—Ç–∞
        let chatRefreshInterval = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        let allEmployees = [];
        let filteredEmployees = [];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π
        let allIssues = [];
        let filteredIssues = [];
        
        // Tailwind –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const BTN_CLASSES = 'h-[52px] w-full flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[15px] font-semibold cursor-pointer transition-all duration-200 shadow-nb hover:bg-nb-navy-600 active:scale-[0.97]';
        const BTN_SELECTED_CLASS = '!bg-orange-600';

        async function handleAction(action) {
            try {
                if (action === 'vacation') {
                    tg.showAlert('–§—É–Ω–∫—Ü–∏—è "–ú–æ–π –æ—Ç–ø—É—Å–∫" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
                    return;
                }
                
                if (action === 'work_mode') {
                    await showWorkModeModal();
                    return;
                }
                
                if (action === 'absence') {
                    await showAbsenceModal();
                    return;
                }
                
                if (action === 'sick_leave') {
                    await showSickLeaveModal();
                    return;
                }
                
                if (action === 'crocotime') {
                    await showCrocotimeModal();
                    return;
                }
                
                if (action === 'tasks') {
                    await showTasksModal();
                    return;
                }
                
                if (action === 'admin' || action === 'admin_menu') {
                    await showAdminMenuModal();
                    return;
                }
                
                if (action === 'sos') {
                    await showSosModal();
                    return;
                }
                
                if (action === 'sos_menu') {
                    await showSosMenuModal();
                    return;
                }
                
                if (action === 'hr') {
                    await showHrMenuModal();
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                tg.showAlert('–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å...');
                
                const response = await fetch('http://localhost:5000/api/actions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        action: action
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    if (result.redirect) {
                        if (result.action === 'work_mode') {
                            await showWorkModeModal();
                        } else if (result.action === 'absence') {
                            await showAbsenceModal();
                        } else if (result.action === 'sos') {
                            await showSosModal();
                        } else if (result.action === 'sos_menu') {
                            await showSosMenuModal();
                        } else if (result.action === 'sick_leave') {
                            await showSickLeaveModal();
                        } else if (result.action === 'admin_menu') {
                            await showAdminMenuModal();
                        }
                    } else {
                        tg.showAlert(result.message || '–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    }
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ–π—Å—Ç–≤–∏—è');
            }
        }
        
        async function showSosModal() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ SOS
                const response = await fetch('http://localhost:5000/api/sos', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                sosOptions = await response.json();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('app').style.display = 'none';
                document.getElementById('sos-menu-modal').style.display = 'none';
                document.getElementById('sos-modal').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∏–ø—ã –ø—Ä–æ–±–ª–µ–º
                const typesContainer = document.getElementById('sos-issue-types');
                typesContainer.innerHTML = '';
                
                sosOptions.issue_types.forEach((type, index) => {
                    const button = document.createElement('button');
                    button.className = BTN_CLASSES;
                    const colors = ['#ef4444', '#f59e0b', '#10b981', '#8b5cf6', '#3b82f6'];
                    const color = colors[index % colors.length];
                    // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
                    let cleanName = type.name.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
                    if (cleanName.includes('–ü—Ä–æ–±–ª–µ–º–∞ –ª–∏—á–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞')) cleanName = '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                    if (cleanName.includes('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞')) cleanName = '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                    button.innerHTML = `<span class="dot" style="background: ${color};"></span><span>${cleanName}</span>`;
                    button.onclick = () => selectIssueType(type.id, button);
                    button.dataset.typeId = type.id;
                    typesContainer.appendChild(button);
                });
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                selectedIssueType = null;
                selectedAnonymity = null;
                sosPseudonym = null;
                sosDescription = null;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ - —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è
                setTimeout(() => {
                    const allButtons = document.querySelectorAll('#sos-issue-types button, #sos-anonymity-options button');
                    allButtons.forEach(btn => {
                        btn.classList.remove(BTN_SELECTED_CLASS.replace('!', ''));
                    });
                }, 100);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
                document.getElementById('sos-anonymity-section').style.display = 'none';
                document.getElementById('sos-anonymity-options').style.display = 'none';
                document.getElementById('sos-pseudonym-section').style.display = 'none';
                document.getElementById('sos-description-section').style.display = 'none';
                document.getElementById('sos-confirmation-section').style.display = 'none';
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
                document.getElementById('sos-pseudonym').value = '';
                document.getElementById('sos-description').value = '';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function selectIssueType(typeId, selectedButton) {
            selectedIssueType = typeId;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–æ–≤ –ø—Ä–æ–±–ª–µ–º
            const typeButtons = document.querySelectorAll('#sos-issue-types button');
            typeButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            if (selectedButton) {
                selectedButton.classList.add('!bg-orange-600');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏
            document.getElementById('sos-anonymity-section').style.display = 'block';
            document.getElementById('sos-anonymity-options').style.display = 'block';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–ø—Ü–∏–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏
            const anonymityContainer = document.getElementById('sos-anonymity-options');
            anonymityContainer.innerHTML = '';
            
            sosOptions.anonymity_options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = BTN_CLASSES;
                const colors = ['#10b981', '#f59e0b', '#8b5cf6'];
                const color = colors[index % colors.length];
                // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
                let cleanName = option.name.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
                if (cleanName.includes('–û—Ç–∫—Ä—ã—Ç–æ (—Å –∏–º–µ–Ω–µ–º)')) cleanName = '–û—Ç–∫—Ä—ã—Ç–æ';
                if (cleanName.includes('–ê–Ω–æ–Ω–∏–º–Ω–æ')) cleanName = '–ê–Ω–æ–Ω–∏–º–Ω–æ';
                button.innerHTML = `<span class="dot" style="background: ${color};"></span><span>${cleanName}</span>`;
                button.onclick = () => selectAnonymity(option.id, button);
                button.dataset.anonymityId = option.id;
                anonymityContainer.appendChild(button);
            });
        }
        
        function selectAnonymity(anonymityId, selectedButton) {
            selectedAnonymity = anonymityId;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏
            const anonymityButtons = document.querySelectorAll('#sos-anonymity-options button');
            anonymityButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            if (selectedButton) {
                selectedButton.classList.add('!bg-orange-600');
            }
            
            if (anonymityId === 'anonymous') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞
                document.getElementById('sos-pseudonym-section').style.display = 'block';
                document.getElementById('sos-description-section').style.display = 'none';
            } else {
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º —Å—Ä–∞–∑—É –∫ –æ–ø–∏—Å–∞–Ω–∏—é
                document.getElementById('sos-pseudonym-section').style.display = 'none';
                document.getElementById('sos-description-section').style.display = 'block';
            }
        }
        
        function selectSosPseudonym() {
            const pseudonymInput = document.getElementById('sos-pseudonym');
            sosPseudonym = pseudonymInput.value.trim();
            
            if (!sosPseudonym) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º');
                return;
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–ø–∏—Å–∞–Ω–∏—é
            document.getElementById('sos-pseudonym-section').style.display = 'none';
            document.getElementById('sos-description-section').style.display = 'block';
        }
        
        async function submitSos() {
            // –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            const descriptionInput = document.getElementById('sos-description');
            sosDescription = descriptionInput.value.trim();
            
            if (!sosDescription) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º—É');
                return;
            }
            
            if (sosDescription.length < 10) {
                tg.showAlert('–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã
            const selectedTypeButton = document.querySelector('#sos-issue-types button.bg-orange-600');
            let typeName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
            if (selectedTypeButton) {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –∏—Å–∫–ª—é—á–∞—è dot
                const textSpan = selectedTypeButton.querySelector('span:last-child');
                typeName = textSpan ? textSpan.textContent.trim() : selectedTypeButton.textContent.trim();
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—Ä–∞—â–µ–Ω–∏—è
            const selectedAnonymityButton = document.querySelector('#sos-anonymity-options button.bg-orange-600');
            let anonymityName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            if (selectedAnonymityButton) {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –∏—Å–∫–ª—é—á–∞—è dot
                const textSpan = selectedAnonymityButton.querySelector('span:last-child');
                anonymityName = textSpan ? textSpan.textContent.trim() : selectedAnonymityButton.textContent.trim();
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            let confirmationText = '';
            if (sosPseudonym) {
                confirmationText += `–ü—Å–µ–≤–¥–æ–Ω–∏–º: ${sosPseudonym}\n`;
            }
            confirmationText += `–û–±—Ä–∞—â–µ–Ω–∏–µ: ${sosDescription}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('sos-confirmation-text').textContent = confirmationText;
            document.getElementById('sos-description-section').style.display = 'none';
            document.getElementById('sos-pseudonym-section').style.display = 'none';
            document.getElementById('sos-confirmation-section').style.display = 'block';
        }
        
        async function confirmSos() {
            try {
                const response = await fetch('http://localhost:5000/api/sos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        issue_type: selectedIssueType,
                        anonymity: selectedAnonymity,
                        description: sosDescription,
                        pseudonym: sosPseudonym || ''
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    tg.showAlert('–Æ—Ö—É üéâ! –ì–æ—Ç–æ–≤–æ!');
                    // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é "–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ"
                        setTimeout(() => {
                        showSosModal();
                        }, 1000);
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
            }
        }
        
        async function showSickLeaveModal() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
                const response = await fetch('http://localhost:5000/api/sick-leave', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                sickLeaveOptions = await response.json();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('app').style.display = 'none';
                document.getElementById('sick-leave-modal').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∏–ø—ã –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
                const typesContainer = document.getElementById('sick-leave-types');
                typesContainer.innerHTML = '';
                
                sickLeaveOptions.leave_types.forEach((type, index) => {
                    const button = document.createElement('button');
                    button.className = BTN_CLASSES;
                    const colors = ['#8b5cf6', '#f59e0b', '#ef4444', '#10b981', '#3b82f6'];
                    const color = colors[index % colors.length];
                    // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
                    let cleanName = type.name.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
                    if (cleanName.includes('–ü–µ—Ä–≤–∏—á–Ω—ã–π –±–æ–ª—å–Ω–∏—á–Ω—ã–π')) cleanName = '–ü–µ—Ä–≤–∏—á–Ω—ã–π';
                    if (cleanName.includes('–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ')) cleanName = '–ü—Ä–æ–¥–ª–µ–Ω–∏–µ';
                    button.innerHTML = `<span class="dot" style="background: ${color};"></span><span>${cleanName}</span>`;
                    button.onclick = () => selectLeaveType(type.id, button);
                    button.dataset.typeId = type.id;
                    typesContainer.appendChild(button);
                });
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                selectedLeaveType = null;
                document.getElementById('sick-leave-form-section').style.display = 'none';
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('sick-leave-number').value = '';
                document.getElementById('sick-leave-start-date').value = '';
                document.getElementById('sick-leave-end-date').value = '';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function selectLeaveType(typeId, selectedButton) {
            selectedLeaveType = typeId;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–æ–≤ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
            const typeButtons = document.querySelectorAll('#sick-leave-types button');
            typeButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            if (selectedButton) {
                selectedButton.classList.add('!bg-orange-600');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('sick-leave-form-section').style.display = 'block';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sick-leave-start-date').value = today;
            document.getElementById('sick-leave-end-date').value = today;
        }
        
        
        async function submitSickLeave() {
            console.log('üîç submitSickLeave() –≤—ã–∑–≤–∞–Ω–∞');
            console.log('üîç selectedLeaveType:', selectedLeaveType);
            
            const leaveNumber = document.getElementById('sick-leave-number').value.trim();
            const startDate = document.getElementById('sick-leave-start-date').value;
            const endDate = document.getElementById('sick-leave-end-date').value;
            
            console.log('üîç –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', { leaveNumber, startDate, endDate });
            
            if (!leaveNumber) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –Ω–æ–º–µ—Ä –≠–õ–ù');
                return;
            }
            
            if (!startDate || !endDate) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –¥–∞—Ç—ã –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ');
                return;
            }
            
            if (startDate > endDate) {
                tg.showAlert('–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                return;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
            const selectedTypeButton = document.querySelector('#sick-leave-types button.bg-orange-600');
            let typeName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
            
            if (selectedTypeButton) {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ span –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏
                const textSpan = selectedTypeButton.querySelector('span:last-child');
                typeName = textSpan ? textSpan.textContent.trim() : selectedTypeButton.textContent.trim();
            } else if (selectedLeaveType) {
                // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –µ—Å—Ç—å selectedLeaveType, –Ω–∞–π–¥–µ–º –ø–æ dataset
                const typeButton = document.querySelector(`#sick-leave-types button[data-type-id="${selectedLeaveType}"]`);
                if (typeButton) {
                    const textSpan = typeButton.querySelector('span:last-child');
                    typeName = textSpan ? textSpan.textContent.trim() : typeButton.textContent.trim();
                }
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
            const startDateFormatted = new Date(startDate).toLocaleDateString('ru-RU');
            const endDateFormatted = new Date(endDate).toLocaleDateString('ru-RU');
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const confirmationText = `–¢–∏–ø: ${typeName}\n–ù–æ–º–µ—Ä –≠–õ–ù: ${leaveNumber}\n–ü–µ—Ä–∏–æ–¥: ${startDateFormatted} - ${endDateFormatted}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('sick-leave-confirmation-text').textContent = confirmationText;
            document.getElementById('sick-leave-form-section').style.display = 'none';
            document.getElementById('sick-leave-confirmation-section').style.display = 'block';
        }
        
        function resetSickLeaveForm() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
            selectedLeaveType = null;
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('sick-leave-number').value = '';
            document.getElementById('sick-leave-start-date').value = '';
            document.getElementById('sick-leave-end-date').value = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.getElementById('sick-leave-form-section').style.display = 'none';
            document.getElementById('sick-leave-confirmation-section').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–æ–≤
            const typeButtons = document.querySelectorAll('#sick-leave-types button');
            typeButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
        }

        function cancelSickLeave() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
            resetSickLeaveForm();
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            showMainApp();
        }
        
        async function confirmSickLeave() {
            console.log('üîç confirmSickLeave() –≤—ã–∑–≤–∞–Ω–∞');
            console.log('üîç selectedLeaveType:', selectedLeaveType);
            try {
                const leaveNumber = document.getElementById('sick-leave-number').value.trim();
                const startDate = document.getElementById('sick-leave-start-date').value;
                const endDate = document.getElementById('sick-leave-end-date').value;
                
                console.log('üîç –î–∞–Ω–Ω—ã–µ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ:', { leaveNumber, startDate, endDate });
                
                const response = await fetch('http://localhost:5000/api/sick-leave', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        leave_type: selectedLeaveType,
                        leave_number: leaveNumber,
                        start_date: startDate,
                        end_date: endDate
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    resetSickLeaveForm(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    tg.showAlert('–Æ—Ö—É üéâ! –ì–æ—Ç–æ–≤–æ!');
                    showMainApp();
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
            }
        }
        
        // ==================== CROCOTIME FUNCTIONS ====================
        
        async function showCrocotimeModal() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ–∫–Ω–∞
            document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                modal.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Crocotime
            document.getElementById('crocotime-modal').style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            document.getElementById('crocotime-stats-section').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
            document.getElementById('crocotime-periods').style.display = 'grid';
        }
        
        function closeCrocotimeModal() {
            document.getElementById('crocotime-modal').style.display = 'none';
            showMainApp();
        }
        
        async function loadCrocotimeStats(period) {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const statsSection = document.getElementById('crocotime-stats-section');
                const statsContent = document.getElementById('crocotime-stats-content');
                const statsTitle = document.getElementById('crocotime-stats-title');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
                document.getElementById('crocotime-periods').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π
                statsSection.style.display = 'grid';
                statsContent.innerHTML = '<div class="text-center p-5"><div class="text-2xl mb-2">‚è≥</div><div>–ó–∞–≥—Ä—É–∂–∞—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...</div></div>';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞
                let periodName = '';
                if (period === 'today') periodName = '—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å';
                else if (period === 'week') periodName = '—Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é';
                else if (period === 'month') periodName = '—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü';
                
                statsTitle.textContent = `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ ${periodName}`;
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const response = await fetch('http://localhost:5000/api/crocotime/stats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        period: period
                    })
                });
                
                const result = await response.json();
                
                if (!response.ok || !result.success) {
                    if (result.error === 'not_found') {
                        statsContent.innerHTML = `
                            <div class="text-center p-4">
                                <div class="text-3xl mb-3">‚ùå</div>
                                <div class="font-bold mb-2">–ü—Ä–æ—Ñ–∏–ª—å –≤ CrocoTime –Ω–µ –Ω–∞–π–¥–µ–Ω</div>
                                <div class="text-xs text-slate-300 leading-relaxed">
                                    –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:<br/>
                                    ‚Ä¢ –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å CrocoTime<br/>
                                    ‚Ä¢ –ò–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—è –≤ –±–æ—Ç–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ CrocoTime<br/>
                                    ‚Ä¢ –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –≤ CrocoTime<br/><br/>
                                    –û–±—Ä–∞—Ç–∏—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã.
                                </div>
                            </div>
                        `;
                    } else {
                        statsContent.innerHTML = `
                            <div class="text-center p-4">
                                <div class="text-3xl mb-3">‚ö†Ô∏è</div>
                                <div class="font-bold mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                <div class="text-xs text-slate-300">${result.message || '–ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É'}</div>
                            </div>
                        `;
                    }
                    return;
                }
                
                if (!result.has_data) {
                    statsContent.innerHTML = `
                        <div class="text-center p-4">
                            <div class="text-3xl mb-3">üì≠</div>
                            <div class="font-bold mb-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                            <div class="text-xs text-slate-300">
                                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ ${periodName}.<br/>
                                –í–æ–∑–º–æ–∂–Ω–æ, —Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–ª(–∞) –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –≤ CrocoTime.
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const stats = result.stats;
                let html = `
                    <div class="space-y-3">
                        <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-3 rounded-lg">
                            <div class="text-xs text-blue-100 mb-1">‚è±Ô∏è –í—Å–µ–≥–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ:</div>
                            <div class="text-2xl font-bold">${stats.total_time || '0:00'}</div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-600 to-green-700 p-3 rounded-lg">
                            <div class="text-xs text-green-100 mb-1">üìÖ –î–Ω–µ–π —Ä–∞–±–æ—Ç—ã:</div>
                            <div class="text-2xl font-bold">${stats.days_worked || 0}</div>
                        </div>
                `;
                
                // –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
                if (stats.days && stats.days.length > 0) {
                    html += `
                        <div class="mt-4 pt-4 border-t border-slate-600">
                            <div class="text-xs font-bold text-slate-300 mb-3">üìä –î–µ—Ç–∞–ª—å–Ω–æ –ø–æ –¥–Ω—è–º:</div>
                            <div class="space-y-2">
                    `;
                    
                    stats.days.forEach(day => {
                        html += `
                            <div class="bg-slate-700 p-2 rounded">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs font-semibold">${day.date || '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}</div>
                                    <div class="text-sm font-bold text-blue-300">${day.time || '0:00'}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                `;
                
                statsContent.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ Crocotime:', error);
                document.getElementById('crocotime-stats-content').innerHTML = `
                    <div class="text-center p-4">
                        <div class="text-3xl mb-3">‚ùå</div>
                        <div class="font-bold mb-2">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</div>
                        <div class="text-xs text-slate-300">–ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ</div>
                    </div>
                `;
            }
        }
        
        function hideCrocotimeStats() {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            document.getElementById('crocotime-stats-section').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
            document.getElementById('crocotime-periods').style.display = 'grid';
        }
        
        // ==================== END CROCOTIME FUNCTIONS ====================
        
        // ==================== TASKS AND REMINDERS FUNCTIONS ====================
        
        let currentFilter = 'all';
        let allTasks = [];

        async function showTasksModal() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ–∫–Ω–∞
            document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                modal.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–¥–∞—á
            document.getElementById('tasks-modal').style.display = 'block';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
            await loadTasks();
            await loadReminders();
        }

        async function loadTasks() {
            try {
                const response = await fetch(`https://mambatron1.github.io/api/tasks?initData=${encodeURIComponent(tg.initData)}`);
                const data = await response.json();
                
                if (data.success) {
                    allTasks = data.tasks;
                    displayTasks();
                } else {
                    document.getElementById('tasks-list').innerHTML = '<div class="text-center text-red-500 p-5"><div class="text-base">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á</div><div class="text-xs mt-2">' + data.error + '</div></div>';
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
                document.getElementById('tasks-list').innerHTML = '<div class="text-center text-red-500 p-5"><div class="text-base">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á</div><div class="text-xs mt-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</div></div>';
            }
        }

        function filterTasks(status) {
            currentFilter = status;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.className = 'px-4 py-2 rounded-lg bg-gray-300 text-gray-700 text-sm transition-all duration-200 active:scale-95';
            });
            document.getElementById(`filter-${status}`).className = 'px-4 py-2 rounded-lg bg-nb-navy-700 text-white text-sm font-semibold transition-all duration-200 active:scale-95';
            
            displayTasks();
        }

        function displayTasks() {
            const filtered = currentFilter === 'all' 
                ? allTasks 
                : allTasks.filter(t => t.status === currentFilter);
            
            const tasksList = document.getElementById('tasks-list');
            
            if (filtered.length === 0) {
                tasksList.innerHTML = '<div class="text-center text-gray-500 p-5"><div class="text-base">üìã –ù–µ—Ç –∑–∞–¥–∞—á</div><div class="text-xs mt-2">–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ú–∞—à—É —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –¥–ª—è –≤–∞—Å</div></div>';
                return;
            }
            
            const priorityColors = {
                low: 'bg-blue-100 text-blue-800',
                medium: 'bg-yellow-100 text-yellow-800',
                high: 'bg-red-100 text-red-800'
            };
            
            const priorityNames = {
                low: '–ù–∏–∑–∫–∏–π',
                medium: '–°—Ä–µ–¥–Ω–∏–π',
                high: '–í—ã—Å–æ–∫–∏–π'
            };
            
            const statusNames = {
                pending: '–í –æ–∂–∏–¥–∞–Ω–∏–∏',
                in_progress: '–í —Ä–∞–±–æ—Ç–µ',
                completed: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                cancelled: '–û—Ç–º–µ–Ω–µ–Ω–æ'
            };
            
            tasksList.innerHTML = filtered.map(task => `
                <div class="bg-white rounded-lg p-4 shadow-md">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            <h4 class="font-semibold text-base">${task.task_text}</h4>
                            ${task.description ? `<p class="text-sm text-gray-600 mt-1">${task.description}</p>` : ''}
                        </div>
                        <span class="px-2 py-1 rounded text-xs ${priorityColors[task.priority]} ml-2">${priorityNames[task.priority]}</span>
                    </div>
                    ${task.due_date ? `<p class="text-xs text-gray-500 mb-2">üìÖ –î–µ–¥–ª–∞–π–Ω: ${new Date(task.due_date).toLocaleDateString('ru-RU')}</p>` : ''}
                    <div class="flex gap-2 mt-3">
                        ${task.status !== 'completed' ? `
                            <button onclick="updateTaskStatus(${task.id}, 'completed')" class="flex-1 px-3 py-2 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 active:scale-95 transition-all duration-200">‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                        ` : '<div class="text-green-600 font-semibold text-sm">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–∞</div>'}
                        <button onclick="deleteTask(${task.id})" class="px-3 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 active:scale-95 transition-all duration-200">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function updateTaskStatus(taskId, status) {
            try {
                const response = await fetch(`https://mambatron1.github.io/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ initData: tg.initData, status })
                });
                
                const data = await response.json();
                if (data.success) {
                    await loadTasks();
                    tg.showAlert('‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω');
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating task:', error);
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏');
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;
            
            try {
                const response = await fetch(`https://mambatron1.github.io/api/tasks/${taskId}?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    await loadTasks();
                    tg.showAlert('‚úÖ –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞');
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏');
            }
        }

        async function loadReminders() {
            try {
                const response = await fetch(`https://mambatron1.github.io/api/reminders?initData=${encodeURIComponent(tg.initData)}`);
                const data = await response.json();
                
                if (data.success) {
                    displayReminders(data.reminders);
                } else {
                    document.getElementById('reminders-list').innerHTML = '<div class="text-center text-red-500 p-5"><div class="text-base">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div><div class="text-xs mt-2">' + data.error + '</div></div>';
                }
            } catch (error) {
                console.error('Error loading reminders:', error);
                document.getElementById('reminders-list').innerHTML = '<div class="text-center text-red-500 p-5"><div class="text-base">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div><div class="text-xs mt-2">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</div></div>';
            }
        }

        function displayReminders(reminders) {
            const active = reminders.filter(r => !r.is_sent && !r.is_cancelled);
            const remindersList = document.getElementById('reminders-list');
            
            if (active.length === 0) {
                remindersList.innerHTML = '<div class="text-center text-gray-500 p-5"><div class="text-base">üîî –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div><div class="text-xs mt-2">–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ú–∞—à—É –Ω–∞–ø–æ–º–Ω–∏—Ç—å –≤–∞–º –æ —á–µ–º-—Ç–æ</div></div>';
                return;
            }
            
            remindersList.innerHTML = active.map(reminder => `
                <div class="bg-white rounded-lg p-4 shadow-md">
                    <p class="font-semibold text-base mb-2">${reminder.reminder_text}</p>
                    <p class="text-xs text-gray-500 mb-3">üïê ${new Date(reminder.reminder_time).toLocaleString('ru-RU')}</p>
                    <button onclick="cancelReminder(${reminder.id})" class="w-full px-3 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 active:scale-95 transition-all duration-200">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                </div>
            `).join('');
        }

        async function cancelReminder(reminderId) {
            if (!confirm('–û—Ç–º–µ–Ω–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ?')) return;
            
            try {
                const response = await fetch(`https://mambatron1.github.io/api/reminders/${reminderId}?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    await loadReminders();
                    tg.showAlert('‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('Error cancelling reminder:', error);
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è');
            }
        }
        
        // ==================== END TASKS AND REMINDERS FUNCTIONS ====================
        
        async function showAbsenceModal() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
                const response = await fetch('http://localhost:5000/api/absence', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                absenceOptions = await response.json();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('app').style.display = 'none';
                document.getElementById('absence-modal').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞—Ç—ã
                const datesContainer = document.getElementById('absence-dates');
                datesContainer.innerHTML = '';
                
                absenceOptions.dates.forEach(date => {
                    const button = document.createElement('button');
                    button.className = BTN_CLASSES;
                    // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ –¥–∞—Ç—ã
                    let dotColor = '#ef4444'; // –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è —Å–µ–≥–æ–¥–Ω—è
                    if (date.id === 'tomorrow') {
                        dotColor = '#f59e0b'; // –æ—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è –∑–∞–≤—Ç—Ä–∞
                    } else if (date.id === 'custom') {
                        dotColor = '#8b5cf6'; // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è "—Å–≤–æ—è –¥–∞—Ç–∞"
                    }
                    button.innerHTML = `<span class="dot" style="background: ${dotColor};"></span><span>${date.name}</span>`;
                    button.onclick = () => selectAbsenceDate(date.id, date.date, button);
                    datesContainer.appendChild(button);
                });
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                selectedAbsenceDate = null;
                selectedAbsenceTime = null;
                customAbsenceDate = null;
                customAbsenceStartTime = null;
                customAbsenceEndTime = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                document.getElementById('absence-time-section').style.display = 'none';
                document.getElementById('absence-times').style.display = 'none';
                document.getElementById('absence-custom-date').style.display = 'none';
                document.getElementById('absence-custom-time').style.display = 'none';
                document.getElementById('absence-confirmation-section').style.display = 'none';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function selectAbsenceDate(dateId, dateValue, selectedButton) {
            selectedAbsenceDate = dateId;
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –¥–∞—Ç
            const allDateButtons = document.querySelectorAll('#absence-dates button');
            allDateButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É –æ—Ä–∞–Ω–∂–µ–≤—ã–º
            selectedButton.classList.add('!bg-orange-600');
            
            if (dateId === 'custom') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞—Ç—ã
                document.getElementById('absence-custom-date').style.display = 'block';
                document.getElementById('absence-time-section').style.display = 'none';
                document.getElementById('absence-times').style.display = 'none';
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
                document.getElementById('absence-time-section').style.display = 'block';
                document.getElementById('absence-times').style.display = 'grid';
                document.getElementById('absence-custom-date').style.display = 'none';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–∞
                const timesContainer = document.getElementById('absence-times');
                timesContainer.innerHTML = '';
                
                absenceOptions.times.forEach(time => {
                    const button = document.createElement('button');
                    button.className = BTN_CLASSES;
                    // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
                    let dotColor = '#10b981'; // –∑–µ–ª–µ–Ω—ã–π –¥–ª—è —É—Ç—Ä–∞
                    if (time.id === 'afternoon') {
                        dotColor = '#3b82f6'; // —Å–∏–Ω–∏–π –¥–ª—è –¥–Ω—è
                    } else if (time.id === 'all_day') {
                        dotColor = '#06b6d4'; // –≥–æ–ª—É–±–æ–π –¥–ª—è –≤—Å–µ–≥–æ –¥–Ω—è
                    } else if (time.id === 'custom') {
                        dotColor = '#8b5cf6'; // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è "—Å–≤–æ–µ –≤—Ä–µ–º—è"
                    }
                    button.innerHTML = `<span class="dot" style="background: ${dotColor};"></span><span>${time.name}</span>`;
                    button.onclick = () => selectAbsenceTime(time.id, time.start, time.end, button);
                    timesContainer.appendChild(button);
                });
            }
        }
        
        function selectAbsenceCustomDate() {
            const dateInput = document.getElementById('absence-date');
            customAbsenceDate = dateInput.value;
            
            if (!customAbsenceDate) {
                tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
            document.getElementById('absence-time-section').style.display = 'block';
            document.getElementById('absence-times').style.display = 'grid';
            document.getElementById('absence-custom-date').style.display = 'none';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–∞
            const timesContainer = document.getElementById('absence-times');
            timesContainer.innerHTML = '';
            
            absenceOptions.times.forEach(time => {
                const button = document.createElement('button');
                button.className = BTN_CLASSES;
                // –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
                let dotColor = '#10b981'; // –∑–µ–ª–µ–Ω—ã–π –¥–ª—è —É—Ç—Ä–∞
                if (time.id === 'afternoon') {
                    dotColor = '#3b82f6'; // —Å–∏–Ω–∏–π –¥–ª—è –¥–Ω—è
                } else if (time.id === 'all_day') {
                    dotColor = '#06b6d4'; // –≥–æ–ª—É–±–æ–π –¥–ª—è –≤—Å–µ–≥–æ –¥–Ω—è
                } else if (time.id === 'custom') {
                    dotColor = '#8b5cf6'; // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è "—Å–≤–æ–µ –≤—Ä–µ–º—è"
                }
                button.innerHTML = `<span class="dot" style="background: ${dotColor};"></span><span>${time.name}</span>`;
                button.onclick = () => selectAbsenceTime(time.id, time.start, time.end, button);
                timesContainer.appendChild(button);
            });
        }
        
        function selectAbsenceTime(timeId, startTime, endTime, selectedButton) {
            selectedAbsenceTime = timeId;
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
            const allTimeButtons = document.querySelectorAll('#absence-times button');
            allTimeButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É –æ—Ä–∞–Ω–∂–µ–≤—ã–º
            selectedButton.classList.add('!bg-orange-600');
            
            if (timeId === 'custom') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏
                document.getElementById('absence-custom-time').style.display = 'block';
                document.getElementById('absence-confirmation-section').style.display = 'none';
            } else {
                customAbsenceStartTime = startTime;
                customAbsenceEndTime = endTime;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                showAbsenceConfirmation();
            }
        }
        
        function showAbsenceConfirmation() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞—Ç—É
            let dateText = '';
            let dateValue = '';
            
            if (selectedAbsenceDate === 'custom') {
                const date = new Date(customAbsenceDate);
                dateText = date.toLocaleDateString('ru-RU');
                dateValue = customAbsenceDate;
            } else {
                const dateOption = absenceOptions.dates.find(d => d.id === selectedAbsenceDate);
                dateText = dateOption.name.substring(dateOption.name.indexOf('(') + 1, dateOption.name.indexOf(')'));
                dateValue = dateOption.date;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è
            let timeText = '';
            let startTimeValue = '';
            let endTimeValue = '';
            
            if (selectedAbsenceTime === 'custom') {
                startTimeValue = document.getElementById('absence-start-time').value;
                endTimeValue = document.getElementById('absence-end-time').value;
                timeText = `${startTimeValue} - ${endTimeValue}`;
            } else {
                const timeOption = absenceOptions.times.find(t => t.id === selectedAbsenceTime);
                timeText = timeOption.name.substring(timeOption.name.indexOf('(') + 1, timeOption.name.indexOf(')'));
                startTimeValue = customAbsenceStartTime;
                endTimeValue = customAbsenceEndTime;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('absence-confirmation-text').innerHTML = 
                `–î–∞—Ç–∞: <strong>${dateText}</strong><br>–í—Ä–µ–º—è: <strong>${timeText}</strong>`;
            
            document.getElementById('absence-custom-time').style.display = 'none';
            document.getElementById('absence-confirmation-section').style.display = 'block';
        }
        
        function confirmAbsence() {
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            submitAbsence();
        }
        
        async function submitAbsence() {
            try {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ —Å–≤–æ–µ –≤—Ä–µ–º—è, –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π
                if (selectedAbsenceTime === 'custom') {
                    customAbsenceStartTime = document.getElementById('absence-start-time').value;
                    customAbsenceEndTime = document.getElementById('absence-end-time').value;
                    
                    if (!customAbsenceStartTime || !customAbsenceEndTime) {
                        tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                        return;
                    }
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞—Ç—É
                let dateValue = '';
                
                if (selectedAbsenceDate === 'custom') {
                    dateValue = customAbsenceDate;
                } else {
                    // –î–ª—è today/tomorrow –±–µ—Ä–µ–º –¥–∞—Ç—É –∏–∑ absenceOptions
                    const dateOption = absenceOptions.dates.find(d => d.id === selectedAbsenceDate);
                    if (dateOption) {
                        dateValue = dateOption.date;
                    }
                }
                
                const response = await fetch('http://localhost:5000/api/absence', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        date_option: selectedAbsenceDate,
                        custom_date: dateValue,
                        time_option: selectedAbsenceTime,
                        start_time: customAbsenceStartTime,
                        end_time: customAbsenceEndTime
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    tg.showAlert(result.message);
                    showMainApp();
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
            }
        }

        async function showWorkModeModal() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
                const response = await fetch('http://localhost:5000/api/work-mode', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }

                workModeOptions = await response.json();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('app').style.display = 'none';
                document.getElementById('work-mode-modal').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã
                const modesContainer = document.getElementById('work-modes');
                modesContainer.innerHTML = '';
                
                workModeOptions.modes.forEach((mode, index) => {
                    const button = document.createElement('button');
                    button.className = BTN_CLASSES;
                    const colors = ['#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#3b82f6'];
                    const color = colors[index % colors.length];
                    // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
                    let cleanName = mode.name.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
                    if (cleanName.includes('–û—Ñ–∏—Å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã')) cleanName = '–û—Ñ–∏—Å–Ω—ã–π';
                    if (cleanName.includes('–£–¥–∞–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã') || cleanName.includes('–£–¥–∞–ª—ë–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã')) cleanName = '–£–¥–∞–ª—ë–Ω–Ω—ã–π';
                    button.innerHTML = `<span class="dot" style="background: ${color};"></span><span>${cleanName}</span>`;
                    button.onclick = () => selectWorkMode(mode.id, button);
                    button.dataset.modeId = mode.id;
                    modesContainer.appendChild(button);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        function selectWorkMode(mode, selectedButton) {
            selectedMode = mode;
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ä–µ–∂–∏–º–æ–≤
            const allModeButtons = document.querySelectorAll('#work-modes button');
            allModeButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            selectedButton.classList.add('!bg-orange-600');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
            document.getElementById('period-section').style.display = 'block';
            document.getElementById('work-periods').style.display = 'grid';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–∏–æ–¥—ã
            const periodsContainer = document.getElementById('work-periods');
            periodsContainer.innerHTML = '';
            
            workModeOptions.periods.forEach((period, index) => {
                const button = document.createElement('button');
                button.className = BTN_CLASSES;
                const colors = ['#f59e0b', '#10b981', '#8b5cf6', '#3b82f6', '#ef4444'];
                const color = colors[index % colors.length];
                // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è
                const cleanName = period.name.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
                button.innerHTML = `<span class="dot" style="background: ${color};"></span><span>${cleanName}</span>`;
                button.onclick = () => selectPeriod(period.id, button);
                button.dataset.periodId = period.id;
                periodsContainer.appendChild(button);
            });
        }

        function selectPeriod(period, selectedButton) {
            selectedPeriod = period;
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤
            const allPeriodButtons = document.querySelectorAll('#work-periods button');
            allPeriodButtons.forEach(btn => {
                btn.classList.remove('!bg-orange-600');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            if (selectedButton) {
                selectedButton.classList.add('!bg-orange-600');
            }
            
            if (period === 'custom') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞—Ç
                document.getElementById('custom-period').style.display = 'block';
                document.getElementById('confirmation-section').style.display = 'none';
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                showConfirmation();
            }
        }

        function showConfirmation() {
            const modeText = workModeOptions.modes.find(m => m.id === selectedMode).name;
            const periodText = workModeOptions.periods.find(p => p.id === selectedPeriod).name;
            
            document.getElementById('confirmation-text').innerHTML = 
                `–†–µ–∂–∏–º: <strong>${modeText}</strong><br>–ü–µ—Ä–∏–æ–¥: <strong>${periodText}</strong>`;
            
            document.getElementById('custom-period').style.display = 'none';
            document.getElementById('confirmation-section').style.display = 'block';
        }
        
        function confirmWorkMode() {
            console.log('üîç confirmWorkMode() –≤—ã–∑–≤–∞–Ω–∞');
            console.log('üîç selectedMode:', selectedMode);
            console.log('üîç selectedPeriod:', selectedPeriod);
            
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            submitWorkMode();
        }

        async function submitWorkMode() {
            console.log('üîç submitWorkMode() –Ω–∞—á–∞—Ç–∞');
            try {
                let startDate = null;
                let endDate = null;
                
                if (selectedPeriod === 'custom') {
                    startDate = document.getElementById('start-date').value;
                    endDate = document.getElementById('end-date').value;
                    
                    if (!startDate || !endDate) {
                        tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã');
                        return;
                    }
                }
                
                const response = await fetch('http://localhost:5000/api/work-mode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        mode: selectedMode,
                        period: selectedPeriod,
                        start_date: startDate,
                        end_date: endDate
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    tg.showAlert('–Æ—Ö—É üéâ! –ì–æ—Ç–æ–≤–æ!');
                    showMainApp();
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
                        }
        }
        
        // –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ showSosMenuModal()
        
        async function loadMyIssues() {
            try {
                const response = await fetch(`http://localhost:5000/api/my-issues?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π');
                }

                const data = await response.json();
                displayMyIssuesList(data.issues);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('sos-issues-list').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π</div>';
            }
        }
        
        function displayMyIssuesList(issues) {
            const container = document.getElementById('sos-issues-list');
            
            if (!issues || issues.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</div>';
                return;
            }
            
            let html = '<div style="padding: 10px;">';
            
            issues.forEach(issue => {
                let statusIcon = 'üü°';
                let statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
                let statusColor = '#ffa500';
                if (issue.status === 'closed') {
                    statusIcon = 'üî¥';
                    statusText = '–ó–∞–∫—Ä—ã—Ç–æ';
                    statusColor = '#ff4757';
                } else if (issue.status === 'resolved') {
                    statusIcon = 'üü¢';
                    statusText = '–†–µ—à–µ–Ω–æ';
                    statusColor = '#2ed573';
                }
                
                const typeIcon = issue.type === 'personal' ? 'üíî' : 'üñ•';
                const typeText = issue.type === 'personal' ? '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                const anonymityText = issue.is_anonymous ? ` (${issue.pseudonym || '–ê–Ω–æ–Ω–∏–º–Ω–æ'})` : '';
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                const newResponsesBadge = issue.has_new_responses ? 
                    '<span style="background: #ff4757; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-left: 5px;">–ù–û–í–´–ï –û–¢–í–ï–¢–´</span>' : '';
                
                // –î–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π —É–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–ª–∏–∫–∞
                const clickHandler = issue.status === 'closed' ? '' : 'onclick="openMyIssueDialog(' + issue.id + ')"';
                const cursorStyle = issue.status === 'closed' ? 'cursor: not-allowed; opacity: 0.6;' : 'cursor: pointer;';
                
                html += '<div style="background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px; border-radius: 8px; ' + cursorStyle + '" ' + clickHandler + '>';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<div style="font-weight: bold;">' + typeIcon + ' –û–±—Ä–∞—â–µ–Ω–∏–µ #' + issue.id + anonymityText + newResponsesBadge + '</div>';
                html += '<div style="font-size: 12px; color: ' + statusColor + ';">' + statusIcon + ' ' + statusText + '</div>';
                html += '</div>';
                html += '<div style="font-size: 13px; color: rgba(255,255,255,0.8); margin-bottom: 5px;">' + typeText + '</div>';
                html += '<div style="font-size: 14px; margin-bottom: 8px;">' + issue.description + '</div>';
                
                if (issue.status === 'closed') {
                    html += '<div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 5px;">üîí –û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ - –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                }
                
                html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6);">–°–æ–∑–¥–∞–Ω–æ: ' + new Date(issue.created_at).toLocaleString('ru-RU') + '</div>';
                
                if (issue.admin_response_count > 0) {
                    html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6);">–û—Ç–≤–µ—Ç–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + issue.admin_response_count + '</div>';
                }
                
                if (issue.last_admin_response_preview) {
                    html += '<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">';
                    html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6);">–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</div>';
                    html += '<div style="font-size: 13px; color: rgba(255,255,255,0.8);">' + issue.last_admin_response_preview + '</div>';
                    html += '</div>';
                }
                
                html += '</div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        let currentMyIssueId = null;
        let dialogRefreshInterval = null;
        let currentDialogMessagesCount = 0;
        let lastDialogData = null;
        let adminDialogMessagesCount = 0;
        let adminLastDialogData = null;
        let currentUserData = null;
        let dialogOpenedFromNotification = false;
        
        
        function startDialogAutoRefresh() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (dialogRefreshInterval) {
                clearInterval(dialogRefreshInterval);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            dialogRefreshInterval = setInterval(async () => {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–æ–π –¥–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã—Ç
                    const userDialogOpen = document.getElementById('my-issue-dialog-modal').style.display === 'block';
                    const adminDialogOpen = document.getElementById('issue-dialog-modal').style.display === 'block';
                    
                    if (currentMyIssueId && userDialogOpen) {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–∏–∞–ª–æ–≥ - —É–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                        await smartUpdateDialog(currentMyIssueId, true);
                    } else if (currentIssueId && adminDialogOpen) {
                        // –ê–¥–º–∏–Ω—Å–∫–∏–π –¥–∏–∞–ª–æ–≥ - —É–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                        await smartUpdateDialog(currentIssueId, false);
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞:', error);
                }
            }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
            
            console.log('‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
        }
        
        function stopDialogAutoRefresh() {
            if (dialogRefreshInterval) {
                clearInterval(dialogRefreshInterval);
                dialogRefreshInterval = null;
            }
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
            currentDialogMessagesCount = 0;
            lastDialogData = null;
            adminDialogMessagesCount = 0;
            adminLastDialogData = null;
        }
        
        // –£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ - –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function smartUpdateDialog(issueId, isUserDialog = true) {
            try {
                const dialogType = isUserDialog ? 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π' : 'üë®‚Äçüíº –ê–¥–º–∏–Ω—Å–∫–∏–π';
                
                const apiUrl = isUserDialog 
                    ? `http://localhost:5000/api/my-issue/${issueId}/dialog?initData=${encodeURIComponent(tg.initData)}`
                    : `http://localhost:5000/api/admin/issue/${issueId}/dialog?initData=${encodeURIComponent(tg.initData)}`;
                
                const response = await fetch(apiUrl, { method: 'GET' });
                
                if (!response.ok) {
                    console.log(`‚ö†Ô∏è ${dialogType} –¥–∏–∞–ª–æ–≥ #${issueId}: HTTP ${response.status}`);
                    return;
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    console.log(`‚ö†Ô∏è ${dialogType} –¥–∏–∞–ª–æ–≥ #${issueId}: success=false`);
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
                const newMessagesCount = data.responses ? data.responses.length : 0;
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∏–∞–ª–æ–≥–∞
                const currentCount = isUserDialog ? currentDialogMessagesCount : adminDialogMessagesCount;
                const lastData = isUserDialog ? lastDialogData : adminLastDialogData;
                
                console.log(`üîÑ ${dialogType} –¥–∏–∞–ª–æ–≥ #${issueId}: —Ç–µ–∫—É—â–∏—Ö=${currentCount}, –Ω–æ–≤—ã—Ö=${newMessagesCount}`);
                
                if (newMessagesCount === currentCount) {
                    // –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º
                    return;
                }
                
                if (currentCount === 0 || !lastData) {
                    // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    if (isUserDialog) {
                        displayMyIssueDialog(data);
                        currentDialogMessagesCount = newMessagesCount;
                        lastDialogData = data;
                    } else {
                        displayIssueDialog(data);
                        adminDialogMessagesCount = newMessagesCount;
                        adminLastDialogData = data;
                    }
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–∞–ª–æ–≥, —Å–æ—Ö—Ä–∞–Ω—è—è —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                const activeElement = document.activeElement;
                const inputId = isUserDialog ? 'my-response-input' : 'admin-response-input';
                const wasInputFocused = activeElement && activeElement.id === inputId;
                const inputValue = wasInputFocused ? activeElement.value : '';
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥
                console.log(`‚úÖ ${dialogType} –¥–∏–∞–ª–æ–≥ #${issueId}: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ${newMessagesCount - currentCount} –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π`);
                
                // üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø: –í–∏–±—Ä–∞—Ü–∏—è + –∑–≤—É–∫ –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
                if (newMessagesCount > currentCount) {
                    try {
                        // –í–∏–±—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp API
                        if (window.Telegram?.WebApp?.HapticFeedback) {
                            window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                            console.log('üì≥ –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏');
                        }
                    } catch (vibrateError) {
                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤–∏–±—Ä–∞—Ü–∏–∏:', vibrateError);
                    }
                }
                
                if (isUserDialog) {
                    displayMyIssueDialog(data);
                    currentDialogMessagesCount = newMessagesCount;
                    lastDialogData = data;
                } else {
                    displayIssueDialog(data);
                    adminDialogMessagesCount = newMessagesCount;
                    adminLastDialogData = data;
                }
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º –ú–ì–ù–û–í–ï–ù–ù–û
                scrollToBottom(isUserDialog, true);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
                if (wasInputFocused) {
                    setTimeout(() => {
                        const input = document.getElementById(inputId);
                        if (input) {
                            input.value = inputValue;
                            input.focus();
                        }
                    }, 50);
                }
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ–∫—É—Å–∞
                setTimeout(() => scrollToBottom(isUserDialog, true), 250);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞:', error);
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–Ω–æ –Ω–æ–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –¥–∏–∞–ª–æ–≥
        function addMessageToDialog(messageText, isFromCurrentUser, isUserDialog) {
            const containerId = isUserDialog ? 'my-issue-dialog-content' : 'issue-dialog-content';
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
            let messagesContainer = container.querySelector('.dialog-messages');
            if (!messagesContainer) {
                // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Ü–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                messagesContainer = document.createElement('div');
                messagesContainer.className = 'dialog-messages';
                messagesContainer.style.cssText = 'margin-bottom: 20px; max-height: 300px; overflow-y: auto;';
                container.appendChild(messagesContainer);
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const messageDiv = document.createElement('div');
            const currentTime = new Date().toLocaleString('ru-RU');
            
            if (isUserDialog) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–∏–∞–ª–æ–≥: —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞, –æ—Ç –∞–¥–º–∏–Ω–∞ - —Å–ª–µ–≤–∞
                const bgColor = isFromCurrentUser 
                    ? 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' 
                    : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                const boxShadow = isFromCurrentUser 
                    ? '0 2px 8px rgba(56, 239, 125, 0.3)' 
                    : '0 2px 8px rgba(102, 126, 234, 0.3)';
                const textColor = 'white';
                const align = isFromCurrentUser ? 'margin-left: auto; margin-right: 0; text-align: right;' : 'margin-right: auto; margin-left: 0; text-align: left;';
                const senderText = isFromCurrentUser ? 'üë§ –í—ã' : 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                
                messageDiv.style.cssText = `background: ${bgColor}; color: ${textColor}; padding: 12px 15px; border-radius: 12px; margin-bottom: 10px; max-width: 80%; word-wrap: break-word; ${align} box-shadow: ${boxShadow};`;
                messageDiv.innerHTML = `
                    <div style="font-size: 14px; margin-bottom: 5px; line-height: 1.4;">${messageText}</div>
                    <div style="font-size: 11px; opacity: 0.8; text-align: right;">
                        ${senderText} ‚Ä¢ ${currentTime}
                    </div>
                `;
            } else {
                // –ê–¥–º–∏–Ω—Å–∫–∏–π –¥–∏–∞–ª–æ–≥: —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞ —Å–ø—Ä–∞–≤–∞, –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ - —Å–ª–µ–≤–∞
                const bgColor = isFromCurrentUser 
                    ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' 
                    : 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                const boxShadow = isFromCurrentUser 
                    ? '0 2px 8px rgba(102, 126, 234, 0.3)' 
                    : '0 2px 8px rgba(56, 239, 125, 0.3)';
                const textColor = 'white';
                const align = isFromCurrentUser ? 'margin-left: auto; margin-right: 0; text-align: right;' : 'margin-right: auto; margin-left: 0; text-align: left;';
                const senderText = isFromCurrentUser ? 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫';
                
                messageDiv.style.cssText = `background: ${bgColor}; color: ${textColor}; padding: 12px 15px; border-radius: 12px; margin-bottom: 10px; max-width: 80%; word-wrap: break-word; ${align} box-shadow: ${boxShadow};`;
                messageDiv.innerHTML = `
                    <div style="font-size: 14px; margin-bottom: 5px; line-height: 1.4;">${messageText}</div>
                    <div style="font-size: 11px; opacity: 0.8; text-align: right;">
                        ${senderText} ‚Ä¢ ${currentTime}
                    </div>
                `;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω–µ—Ü
            messagesContainer.appendChild(messageDiv);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            setTimeout(() => {
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å
                messageDiv.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'end',
                    inline: 'nearest'
                });
            }, 100);
        }

        
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∏–∑—É –¥–∏–∞–ª–æ–≥–∞
        function scrollToBottom(isUserDialog, instant = false) {
            
            console.log('üîΩ –ù–ê–ß–ò–ù–ê–ï–ú –ê–í–¢–û–ü–†–û–ö–†–£–¢–ö–£ –¥–ª—è', isUserDialog ? '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ' : '–∞–¥–º–∏–Ω—Å–∫–æ–≥–æ', '—á–∞—Ç–∞');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            const forceScrollToBottom = () => {
                // –ì–õ–ê–í–ù–û–ï - –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –°–ê–ú–û –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û!
                const modalId = isUserDialog ? 'my-issue-dialog-modal' : 'issue-dialog-modal';
                const modal = document.getElementById(modalId);
                
                if (modal) {
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                    const scrollTarget = modal.scrollHeight + 10000; // –û–ì–†–û–ú–ù–´–ô –∑–∞–ø–∞—Å!
                    modal.scrollTop = scrollTarget;
                    console.log(`‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∏–ª–∏ ${modalId} –¥–æ ${scrollTarget}, —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è: ${modal.scrollTop}`);
                    
                    // –¢–∞–∫–∂–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                    const allScrollables = modal.querySelectorAll('*');
                    allScrollables.forEach(el => {
                        if (el.scrollHeight > el.clientHeight) {
                            el.scrollTop = el.scrollHeight + 10000;
                            console.log('üìú –¢–∞–∫–∂–µ –ø—Ä–æ–∫—Ä—É—Ç–∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç:', el.className || el.tagName);
                        }
                    });
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
                    const containerId = isUserDialog ? 'my-issue-dialog-content' : 'issue-dialog-content';
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.scrollTop = container.scrollHeight + 10000;
                        
                        const messagesContainer = container.querySelector('.dialog-messages');
                        if (messagesContainer) {
                            messagesContainer.scrollTop = messagesContainer.scrollHeight + 10000;
                        }
                    }
                } else {
                    console.log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:', modalId);
                }
            };
            
            // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –°–†–ê–ó–£ –∏ –ú–ù–û–ì–û –†–ê–ó
            forceScrollToBottom();
            
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ (DOM –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ)
            setTimeout(forceScrollToBottom, 50);
            setTimeout(forceScrollToBottom, 150);
            setTimeout(forceScrollToBottom, 300);
            setTimeout(forceScrollToBottom, 500);
            setTimeout(forceScrollToBottom, 750);
            setTimeout(forceScrollToBottom, 1000);
            
            console.log('‚úÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ 7 –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏!');
        }
        
        async function openMyIssueDialog(issueId) {
            try {
                currentMyIssueId = issueId;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ–∫–Ω–∞
                document.getElementById('app').style.display = 'none';
                document.getElementById('sos-menu-modal').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∏–∞–ª–æ–≥–∞
                document.getElementById('my-issue-dialog-modal').style.display = 'block';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
                await loadMyIssueDialog(issueId);
                
                // –û—Ç–º–µ—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
                await markResponsesAsRead(issueId);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
                startDialogAutoRefresh();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º');
            }
        }
        
        async function loadMyIssueDialog(issueId) {
            try {
                const container = document.getElementById('my-issue-dialog-content');
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞...</div>';
                
                const response = await fetch(`http://localhost:5000/api/my-issue/${issueId}/dialog?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞');
                }

                const data = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞—â–µ–Ω–∏—è - –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–æ, –±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                if (data.issue && data.issue.status === 'closed') {
                    container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">' +
                        '<div style="font-size: 18px; margin-bottom: 10px;">üîí</div>' +
                        '<div>–≠—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ</div>' +
                        '<div style="font-size: 14px; margin-top: 10px; color: rgba(255,255,255,0.5);">–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ</div>' +
                        '</div>';
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
                    const inputContainer = document.querySelector('#my-issue-dialog-modal div[style*="position: fixed"]');
                    if (inputContainer) {
                        inputContainer.style.display = 'none';
                    }
                    return;
                }
                
                displayMyIssueDialog(data);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
                const inputContainer = document.querySelector('#my-issue-dialog-modal div[style*="position: fixed"]');
                if (inputContainer) {
                    inputContainer.style.display = 'block';
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É–º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                currentDialogMessagesCount = data.responses ? data.responses.length : 0;
                lastDialogData = data;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞:', error);
                document.getElementById('my-issue-dialog-content').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–∞</div>';
            }
        }
        
        function displayMyIssueDialog(data) {
            const container = document.getElementById('my-issue-dialog-content');
            const issue = data.issue;
            const responses = data.responses || [];
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏ (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê)
            const typeIcon = issue.issue_type === 'personal' ? 'üíî' : 'üñ•';
            const typeText = issue.issue_type === 'personal' ? '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
            const anonymityText = issue.is_anonymous ? ` (${issue.pseudonym || '–ê–Ω–æ–Ω–∏–º–Ω–æ'})` : '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê)
            let statusIcon = 'üü°';
            let statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
            let statusColor = '#ffa500';
            if (issue.status === 'closed') {
                statusIcon = 'üî¥';
                statusText = '–ó–∞–∫—Ä—ã—Ç–æ';
                statusColor = '#ff4757';
            } else if (issue.status === 'resolved') {
                statusIcon = 'üü¢';
                statusText = '–†–µ—à–µ–Ω–æ';
                statusColor = '#2ed573';
            }
            
            let html = '';
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏ (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê)
            html += '<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: var(--radius); margin-bottom: 15px;">';
            html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
            html += '<h3 style="margin: 0; font-size: 16px; line-height: 1.4;">' + typeIcon + ' –û–±—Ä–∞—â–µ–Ω–∏–µ #' + issue.id + anonymityText + '</h3>';
            html += '<div style="font-size: 12px; color: ' + statusColor + '; font-weight: 600;">' + statusIcon + ' ' + statusText + '</div>';
            html += '</div>';
            html += '<div style="font-size: 13px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">' + typeText + '</div>';
            html += '<div style="font-size: 14px; margin-bottom: 12px; line-height: 1.4;">' + issue.description + '</div>';
            html += '<div style="font-size: 12px; color: rgba(255,255,255,0.6);">üïê –°–æ–∑–¥–∞–Ω–æ: ' + new Date(issue.created_at).toLocaleString('ru-RU') + '</div>';
            
            // –ï—Å–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê)
            if (issue.status === 'closed') {
                html += '<div style="margin-top: 12px; padding: 10px; background: rgba(255, 71, 87, 0.2); border-radius: var(--radius); font-size: 12px; color: rgba(255,255,255,0.9);">';
                html += 'üîí –≠—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.';
                html += '</div>';
            }
            
            html += '</div>';
            
            // –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º)
            if (responses.length > 0) {
                html += '<div class="dialog-messages" style="margin-bottom: 15px;">';
                html += '<h3 style="font-size: 16px; line-height: 1.4; margin-bottom: 15px;">üí¨ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞</h3>';
                
                responses.forEach(response => {
                    const isAdminMessage = response.responder_phone === 'admin';
                    // –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–º–æ—Ç—Ä–∏—Ç —á–∞—Ç: —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∞ - —Å–ª–µ–≤–∞ (–≤—Ö–æ–¥—è—â–∏–µ), —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è - —Å–ø—Ä–∞–≤–∞ (–∏—Å—Ö–æ–¥—è—â–∏–µ)
                    const messageStyle = isAdminMessage 
                        ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-right: auto; text-align: left; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);'
                        : 'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; margin-left: auto; text-align: right; box-shadow: 0 2px 8px rgba(56, 239, 125, 0.3);';
                    
                    html += '<div style="margin: 10px 0; padding: 12px 15px; border-radius: 12px; max-width: 80%; word-wrap: break-word; ' + messageStyle + '">';
                    html += '<div style="font-size: 14px; margin-bottom: 6px; line-height: 1.4;">' + response.response_text + '</div>';
                    html += '<div style="font-size: 11px; opacity: 0.8;">';
                    html += (isAdminMessage ? 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –í—ã') + ' ‚Ä¢ ' + new Date(response.created_at).toLocaleString('ru-RU');
                    html += '</div>';
                    html += '</div>';
                });
                
                html += '</div>';
            } else {
                html += '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px; font-style: italic;">';
                html += 'üí≠ –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤. –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!';
                html += '</div>';
            }
            
            container.innerHTML = html;
            
            // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è (–ö–û–ü–ò–Ø –ê–î–ú–ò–ù–°–ö–û–ì–û –ß–ê–¢–ê)
            const inputContainer = document.querySelector('#my-issue-dialog-modal div[style*="position: fixed"]');
            if (inputContainer) {
                const input = document.getElementById('my-response-input');
                const button = inputContainer.querySelector('button');
                
                if (issue.status === 'closed') {
                    // –î–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –¥–µ–ª–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
                    inputContainer.style.opacity = '0.6';
                    if (input) {
                        input.placeholder = '–û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ - –æ—Ç–≤–µ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã';
                        input.style.background = 'rgba(255, 71, 87, 0.2)';
                        input.disabled = true;
                    }
                    if (button) {
                        button.style.background = '#ff4757';
                        button.innerHTML = 'üîí –ó–∞–∫—Ä—ã—Ç–æ';
                        button.disabled = true;
                    }
                } else {
                    // –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π –≤–∏–¥
                    inputContainer.style.opacity = '1';
                    if (input) {
                        input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...';
                        input.style.background = 'rgba(255,255,255,0.1)';
                        input.disabled = false;
                    }
                    if (button) {
                        button.style.background = 'var(--accent)';
                        button.innerHTML = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
                        button.disabled = false;
                    }
                }
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
            setTimeout(() => {
                const scrollableContainer = document.getElementById('my-issue-dialog-scroll');
                if (scrollableContainer) {
                    console.log('–ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–Ω–∏–∑');
                    scrollableContainer.scrollTop = scrollableContainer.scrollHeight;
                } else {
                    console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä my-issue-dialog-scroll –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }, 100);
        }
        
        
        function handleMyResponseEnterKey(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMyResponse();
            }
        }
        
        
        async function showIssueChat(issueId) {
            try {
                currentIssueId = issueId;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —á–∞—Ç–∞
                const response = await fetch(`http://localhost:5000/api/issue-chat/${issueId}?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞');
                }

                const chatData = await response.json();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞
                document.getElementById('app').style.display = 'none';
                document.getElementById('work-mode-modal').style.display = 'none';
                document.getElementById('absence-modal').style.display = 'none';
                document.getElementById('sos-modal').style.display = 'none';
                document.getElementById('sos-menu-modal').style.display = 'none';
                document.getElementById('sick-leave-modal').style.display = 'none';
                document.getElementById('hr-menu-modal').style.display = 'none';
                document.getElementById('hr-period-modal').style.display = 'none';
                document.getElementById('issue-chat-modal').style.display = 'block';
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—Ä–∞—â–µ–Ω–∏–∏
                const issue = chatData.issue;
                document.getElementById('chat-title').textContent = `üí¨ –û–±—Ä–∞—â–µ–Ω–∏–µ #${issue.id}`;
                
                let issueTypeText = issue.type === 'personal' ? 'üíî –õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : 'üñ• –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                if (issue.is_anonymous) {
                    issueTypeText += ' (–∞–Ω–æ–Ω–∏–º–Ω–æ)';
                    if (issue.pseudonym) {
                        issueTypeText += ` - ${issue.pseudonym}`;
                    }
                }
                
                document.getElementById('issue-title').textContent = issueTypeText;
                document.getElementById('issue-description').textContent = issue.description;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                displayChatMessages(chatData.messages);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞—â–µ–Ω–∏—è
                if (issue.status === 'closed') {
                    // –û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ - —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    document.getElementById('chat-input-area').style.display = 'none';
                    document.getElementById('chat-closed-message').style.display = 'block';
                } else {
                    // –û–±—Ä–∞—â–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    document.getElementById('chat-input-area').style.display = 'flex';
                    document.getElementById('chat-closed-message').style.display = 'none';
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞
                    if (chatRefreshInterval) {
                        clearInterval(chatRefreshInterval);
                    }
                    chatRefreshInterval = setInterval(() => {
                        refreshChat();
                    }, 3000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞');
            }
        }
        
        function displayChatMessages(messages) {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.style.marginBottom = '15px';
                
                const isFromAdmin = message.from_admin;
                const alignment = isFromAdmin ? 'left' : 'right';
                const bgColor = isFromAdmin ? 'rgba(74, 144, 226, 0.3)' : 'rgba(76, 205, 196, 0.3)';
                const textAlign = isFromAdmin ? 'left' : 'right';
                
                messageDiv.innerHTML = `
                    <div style="text-align: ${textAlign};">
                        <div style="display: inline-block; max-width: 70%; padding: 10px 15px; background: ${bgColor}; border-radius: 12px; text-align: left;">
                            <div style="font-weight: bold; margin-bottom: 5px; color: rgba(255,255,255,0.8); font-size: 12px;">
                                ${isFromAdmin ? 'üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë§ –í—ã'}
                            </div>
                            <div style="color: white;">
                                ${message.text}
                            </div>
                            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 5px;">
                                ${new Date(message.timestamp).toLocaleString('ru-RU')}
                            </div>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            });
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        async function refreshChat() {
            if (!currentIssueId) return;
            
            try {
                const response = await fetch(`http://localhost:5000/api/issue-chat/${currentIssueId}?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (response.ok) {
                    const chatData = await response.json();
                    displayChatMessages(chatData.messages);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞:', error);
            }
        }
        
        async function sendChatMessage() {
            if (!currentIssueId) return;
            
            const messageInput = document.getElementById('chat-message-input');
            const messageText = messageInput.value.trim();
            
            if (!messageText) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:5000/api/issue-chat/${currentIssueId}/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        message: messageText
                    })
                });

                if (response.ok) {
                    messageInput.value = '';
                    // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç
                    await refreshChat();
                } else {
                    const result = await response.json();
                    tg.showAlert('–û—à–∏–±–∫–∞: ' + result.error);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞
        if (window.performance && window.performance.navigation.type === 1) {
            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –æ—á–∏—â–∞–µ–º –∫–µ—à
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–∏–∑–∞–π–Ω–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                const indicator = document.getElementById('design-indicator');
                if (indicator) {
                    indicator.style.opacity = '0';
                    indicator.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => indicator.style.display = 'none', 500);
                }
            }, 3000);
            const messageInput = document.getElementById('chat-message-input');
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
            
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã
            // checkNewResponsesOnLoad();
            // setInterval(checkNewResponsesOnLoad, 30000);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function checkNewResponsesOnLoad() {
            try {
                console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã...');
                const response = await fetch(`http://localhost:5000/api/check-new-responses?initData=${encodeURIComponent(tg.initData)}`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:', response.status);
                    return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å
                }

                const data = await response.json();
                console.log('–û—Ç–≤–µ—Ç API check-new-responses:', data);
                
                if (data.success && data.total_count > 0) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup —Å –Ω–æ–≤—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
                    let message;
                    
                    if (data.issues_with_new_responses.length === 1) {
                        // –û–¥–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ
                        const issue = data.issues_with_new_responses[0];
                        const typeIcon = issue.issue_type === 'personal' ? 'üíî' : 'üñ•';
                        message = `${typeIcon} –û–±—Ä–∞—â–µ–Ω–∏–µ #${issue.issue_id}\n`;
                        message += `${issue.description}\n\n`;
                        message += `–ù–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${issue.new_responses_count}`;
                    } else {
                        // –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞—â–µ–Ω–∏–π
                        message = `–£ –≤–∞—Å ${data.total_count} –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è:\n\n`;
                        
                        data.issues_with_new_responses.forEach(issue => {
                            const typeIcon = issue.issue_type === 'personal' ? 'üíî' : 'üñ•';
                            message += `${typeIcon} –û–±—Ä–∞—â–µ–Ω–∏–µ #${issue.issue_id}\n`;
                            message += `${issue.description}\n`;
                            message += `–ù–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${issue.new_responses_count}\n\n`;
                        });
                    }
                    
                    const buttonText = data.issues_with_new_responses.length === 1 ? '–û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥' : '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ';
                    
                    tg.showPopup({
                        title: 'üì© –ù–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã!',
                        message: message,
                        buttons: [
                            {id: 'view', type: 'default', text: buttonText},
                            {id: 'later', type: 'cancel', text: '–ü–æ–∑–∂–µ'}
                        ]
                    }, function(buttonId) {
                        if (buttonId === 'view') {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            const isAdmin = currentUserData && currentUserData.user && currentUserData.user.is_admin;
                            
                            if (isAdmin) {
                                // –ê–¥–º–∏–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏
                                if (data.issues_with_new_responses.length === 1) {
                                    const issueId = data.issues_with_new_responses[0].issue_id;
                                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –¥–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã—Ç –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                    dialogOpenedFromNotification = true;
                                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–π –¥–∏–∞–ª–æ–≥
                                    openIssueDialog(issueId);
                                } else {
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏
                                    showIssuesManagement();
                                }
                            } else {
                                // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–≤–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è
                                if (data.issues_with_new_responses.length === 1) {
                                    const issueId = data.issues_with_new_responses[0].issue_id;
                                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –¥–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã—Ç –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                    dialogOpenedFromNotification = true;
                                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–∏–∞–ª–æ–≥
                                    openMyIssueDialog(issueId);
                                } else {
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ "–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è"
                                    showSosMenuModal();
                                }
                            }
                        }
                    });
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:', error);
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            }
        }
        
        // –û—Ç–º–µ—Ç–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
        async function markResponsesAsRead(issueId) {
            try {
                console.log('–û—Ç–º–µ—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è:', issueId);
                const response = await fetch(`http://localhost:5000/api/mark-responses-read/${issueId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData
                    })
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ:', error);
            }
        }
        
        function closeMyIssueDialog() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
            stopDialogAutoRefresh();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥
            document.getElementById('my-issue-dialog-modal').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞
            const responseInput = document.getElementById('my-response-input');
            if (responseInput) {
                responseInput.value = '';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—É–¥–∞ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥
            if (dialogOpenedFromNotification) {
                // –ï—Å–ª–∏ –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É
                dialogOpenedFromNotification = false;
                showMainApp();
            } else {
                // –ï—Å–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É
                showSosMenuModal();
            }
        }
        
        function closeIssueDialog() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
            stopDialogAutoRefresh();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥
            document.getElementById('issue-dialog-modal').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞
            const responseInput = document.getElementById('admin-response-input');
            if (responseInput) {
                responseInput.value = '';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—É–¥–∞ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥
            if (dialogOpenedFromNotification) {
                // –ï—Å–ª–∏ –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≥–ª–∞–≤–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É
                dialogOpenedFromNotification = false;
                showMainApp();
            } else {
                // –ï—Å–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Å—è –∫ —Å–ø–∏—Å–∫—É
                showIssuesManagement();
            }
        }

        // –£–¥–∞–ª–µ–Ω–æ –≤—Ç–æ—Ä–æ–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ showSosMenuModal()
        
        function showAuthScreen(firstName) {
            console.log(`üîê showAuthScreen –≤—ã–∑–≤–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${firstName}`);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞—Å—Ç–∞–≤–∫—É —Å –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
            hideSplashScreen();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ Telegram WebApp –ü–ï–†–ï–î –∑–∞–º–µ–Ω–æ–π body
            window._telegramWebApp = window.Telegram?.WebApp;
            
            // –°–∫—Ä—ã–≤–∞–µ–º loading –∏ error
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const appEl = document.getElementById('app');
            
            if (loadingEl) loadingEl.style.display = 'none';
            if (errorEl) errorEl.style.display = 'none';
            if (appEl) appEl.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.body.innerHTML = `
                <div class="fixed inset-0 bg-nb-bg flex items-center justify-center p-6">
                    <div class="max-w-md w-full text-center">
                        <!-- –ò–∫–æ–Ω–∫–∞ -->
                        <div class="mb-6">
                            <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-nb-accent to-nb-accent-dark flex items-center justify-center text-5xl shadow-nb">
                                üîê
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
                        <h1 class="text-2xl font-bold text-nb-ink mb-3">
                            –ü—Ä–∏–≤–µ—Ç, ${firstName}! üëã
                        </h1>
                        
                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <p class="text-nb-ink/70 text-[15px] leading-relaxed mb-8">
                            –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –±–æ—Ç–µ.
                            <br><br>
                            –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É! üöÄ
                        </p>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
                        <button 
                            onclick="openBot()"
                            class="w-full h-[52px] flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-accent text-white text-[16px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-accent-dark shadow-nb mb-4"
                        >
                            <span>üì±</span>
                            <span>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –±–æ—Ç–µ</span>
                        </button>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
                        <button 
                            onclick="checkAuthStatus()"
                            class="w-full h-[52px] flex items-center justify-center gap-2 px-6 border-none rounded-nb bg-nb-navy-700 text-white text-[16px] font-semibold cursor-pointer transition-all duration-200 active:scale-[0.97] hover:bg-nb-navy-600 shadow-nb mb-4"
                        >
                            <span>üîÑ</span>
                            <span>–Ø —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª—Å—è</span>
                        </button>
                        
                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <p class="text-nb-ink/50 text-[13px]">
                            –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ üíñ
                        </p>
                    </div>
                </div>
            `;
        }
        
        let authCheckInterval = null;
        
        function openBot() {
            console.log('ü§ñ –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ Telegram WebApp
            const tgApp = window._telegramWebApp || window.Telegram?.WebApp;
            
            if (tgApp) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ —á–µ—Ä–µ–∑ deep link (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ Telegram)
                const botUsername = 'NBtender_bot'; // –ò–º—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
                tgApp.openTelegramLink(`https://t.me/${botUsername}?start=auth`);
                
                console.log('‚úÖ –ë–æ—Ç –æ—Ç–∫—Ä—ã—Ç! –û–∂–∏–¥–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
                
                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                updateAuthButton('‚è≥ –û–∂–∏–¥–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...', true);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
                startAuthCheck();
            } else {
                console.error('‚ùå Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.');
            }
        }
        
        function updateAuthButton(text, disabled = false) {
            const button = document.querySelector('button[onclick="openBot()"]');
            if (button) {
                button.innerHTML = `<span>üì±</span><span>${text}</span>`;
                button.disabled = disabled;
                if (disabled) {
                    button.style.opacity = '0.6';
                    button.style.cursor = 'not-allowed';
                }
            }
        }
        
        async function checkAuthStatus() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            try {
                const response = await fetch('http://localhost:5000/api/user-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData: window._telegramWebApp?.initData || window.Telegram?.WebApp?.initData })
                });
                
                if (response.status === 200) {
                    console.log('üéâ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                    stopAuthCheck();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                    updateAuthButton('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', true);
                    
                    // –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                    
                    return true;
                }
                
                console.log('‚è≥ –ï—â–µ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ...');
                return false;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                return false;
            }
        }
        
        function startAuthCheck() {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
            stopAuthCheck();
            
            // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(checkAuthStatus, 3000);
            
            // –ó–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            authCheckInterval = setInterval(checkAuthStatus, 5000);
        }
        
        function stopAuthCheck() {
            if (authCheckInterval) {
                clearInterval(authCheckInterval);
                authCheckInterval = null;
            }
        }
        
        function showMainApp() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
            stopDialogAutoRefresh();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            const modals = [
                'work-mode-modal', 'absence-modal', 'sos-modal', 'sos-menu-modal',
                'sick-leave-modal', 'issue-chat-modal', 'admin-menu-modal',
                'hr-menu-modal', 'hr-period-modal'
            ];
            
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && modal.style.display !== 'none') {
                    modal.classList.add('animate-slide-out');
                    setTimeout(() => {
                        modal.style.display = 'none';
                        modal.classList.remove('animate-slide-out');
                    }, 300);
                } else if (modal) {
                    modal.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            const app = document.getElementById('app');
            app.style.display = 'block';
            app.classList.add('animate-fade-in');
            document.getElementById('employees-management-modal').style.display = 'none';
            document.getElementById('issues-management-modal').style.display = 'none';
            document.getElementById('broadcast-modal').style.display = 'none';
            document.getElementById('messaging-menu-modal').style.display = 'none';
            document.getElementById('employee-message-modal').style.display = 'none';
            document.getElementById('send-employee-message-modal').style.display = 'none';
            document.getElementById('add-employee-modal').style.display = 'none';
            document.getElementById('edit-employee-modal').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞
            if (chatRefreshInterval) {
                clearInterval(chatRefreshInterval);
                chatRefreshInterval = null;
            }
            currentIssueId = null;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
            selectedMode = null;
            selectedPeriod = null;
            document.getElementById('period-section').style.display = 'none';
            document.getElementById('work-periods').style.display = 'none';
            document.getElementById('custom-period').style.display = 'none';
            document.getElementById('confirmation-section').style.display = 'none';
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
            selectedAbsenceDate = null;
            selectedAbsenceTime = null;
            customAbsenceDate = null;
            customAbsenceStartTime = null;
            customAbsenceEndTime = null;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è SOS
            selectedIssueType = null;
            selectedAnonymity = null;
            sosPseudonym = null;
            sosDescription = null;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ
            selectedLeaveType = null;
        }

        // ============================================================================
        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –û–ë–†–ê–©–ï–ù–ò–Ø–ú–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        // ============================================================================
        
        function showSosMenuModal() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            document.getElementById('app').style.display = 'none';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const modalsToHide = [
                'work-mode-modal', 'absence-modal', 'sos-modal', 
                'sick-leave-modal', 'issue-chat-modal', 'admin-menu-modal',
                'my-issue-dialog-modal', 'issue-dialog-modal'
            ];
            
            modalsToHide.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è"
            document.getElementById('sos-menu-modal').style.display = 'block';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π
            loadMyIssues();
        }
        
        async function loadMyIssues() {
            try {
                const container = document.getElementById('sos-issues-list');
                container.innerHTML = `
                    <div style="text-align: center; color: var(--muted); padding: 20px;">
                        <div style="font-size: 16px;">üìà –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...</div>
                        <div style="font-size: 12px; margin-top: 8px;">–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã</div>
                    </div>
                `;
                
                const response = await fetch(`http://localhost:5000/api/my-issues?initData=${encodeURIComponent(tg.initData)}`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    displayMyIssues(data.issues);
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; color: #ff6b6b; padding: 20px;">
                            <div style="font-size: 16px;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div style="font-size: 12px; margin-top: 8px;">${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π:', error);
                const container = document.getElementById('sos-issues-list');
                container.innerHTML = `
                    <div style="text-align: center; color: #ff6b6b; padding: 20px;">
                        <div style="font-size: 16px;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>
                        <div style="font-size: 12px; margin-top: 8px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</div>
                    </div>
                `;
            }
        }
        
        function displayMyIssues(issues) {
            const container = document.getElementById('sos-issues-list');
            
            if (!issues || issues.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--muted); padding: 30px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìù</div>
                        <div style="font-size: 16px; margin-bottom: 8px;">–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.6);">–°–æ–∑–¥–∞–π –Ω–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ–Ω—é "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å"</div>
                        <div style="margin-top: 20px;">
                            <button onclick="showSosModal()" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; box-shadow: 0 2px 8px rgba(56, 239, 125, 0.3); font-weight: bold;">
                                –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            issues.forEach(issue => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏ —Å—Ç–∏–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
                let bgGradient, statusIcon, statusText, statusBadgeColor;
                
                if (issue.status === 'active') {
                    bgGradient = 'linear-gradient(135deg, rgba(17, 153, 142, 0.15) 0%, rgba(56, 239, 125, 0.15) 100%)';
                    statusIcon = 'üü¢';
                    statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);';
                } else if (issue.status === 'in_progress') {
                    bgGradient = 'linear-gradient(135deg, rgba(255, 165, 2, 0.15) 0%, rgba(255, 193, 7, 0.15) 100%)';
                    statusIcon = 'üü†';
                    statusText = '–í —Ä–∞–±–æ—Ç–µ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #ffa502 0%, #ffc107 100%);';
                } else {
                    bgGradient = 'linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%)';
                    statusIcon = 'üî¥';
                    statusText = '–ó–∞–∫—Ä—ã—Ç–æ';
                    statusBadgeColor = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
                }
                
                const typeIcon = issue.type === 'technical' ? 'üñ•Ô∏è' : 'üíî';
                const typeText = issue.type === 'technical' ? '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞' : '–õ–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞';
                
                const hasNewResponses = issue.has_new_responses;
                const newResponsesBadge = hasNewResponses ? 
                    `<span style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); color: white; padding: 3px 8px; border-radius: 10px; font-size: 10px; margin-left: 8px; box-shadow: 0 2px 4px rgba(255,107,107,0.3);">–ù–û–í–û–ï</span>` : '';
                
                html += `
                    <div onclick="openMyIssueDialog(${issue.id})" style="
                        background: ${bgGradient};
                        border: 1px solid rgba(255,255,255,0.1);
                        padding: 16px; 
                        border-radius: 12px; 
                        margin-bottom: 12px; 
                        cursor: pointer;
                        transition: all 0.2s ease;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">${typeIcon}</span>
                                <div>
                                    <div style="font-weight: bold; font-size: 14px; color: white;">
                                        ${typeText}
                                ${newResponsesBadge}
                            </div>
                                    <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 2px;">
                                        –û–±—Ä–∞—â–µ–Ω–∏–µ #${issue.id}
                            </div>
                        </div>
                        </div>
                            <div style="${statusBadgeColor} padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; color: white; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">
                                ${statusIcon} ${statusText}
                            </div>
                            </div>
                        
                        <div style="font-size: 13px; color: rgba(255,255,255,0.95); margin-bottom: 12px; line-height: 1.5; background: rgba(0,0,0,0.15); padding: 10px; border-radius: 8px;">
                            ${issue.description}
                    </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: rgba(255,255,255,0.7);">
                            <div>
                                üïê ${new Date(issue.created_at).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                        </div>
                        ${issue.admin_response_count > 0 ? `
                                <div style="color: rgba(255,255,255,0.9); font-weight: bold;">
                                    üí¨ ${issue.admin_response_count} ${issue.admin_response_count === 1 ? '–æ—Ç–≤–µ—Ç' : '–æ—Ç–≤–µ—Ç–æ–≤'}
                                    ${issue.unread_admin_responses > 0 ? `<span style="color: #ff6b6b;"> ‚Ä¢ ${issue.unread_admin_responses} –Ω–æ–≤—ã—Ö</span>` : ''}
                    </div>
                            ` : `
                                <div style="color: rgba(255,255,255,0.5); font-style: italic;">
                                    –ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤
                    </div>
                            `}
                            </div>
                        </div>
                    `;
                });
            
            container.innerHTML = html;
        }
        
        
        function closeMyIssueDialog() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
            stopDialogAutoRefresh();
            
            document.getElementById('my-issue-dialog-modal').style.display = 'none';
            document.getElementById('sos-menu-modal').style.display = 'block';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
            currentMyIssueId = null;
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏
            loadMyIssues();
        }
        
        async function sendMyResponse() {
            const input = document.getElementById('my-response-input');
            const responseText = input.value.trim();
            
            if (!responseText) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞');
                return;
            }
            
            if (!currentMyIssueId) {
                tg.showAlert('–û—à–∏–±–∫–∞: ID –æ–±—Ä–∞—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`http://localhost:5000/api/my-issue/${currentMyIssueId}/respond`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData,
                        response_text: responseText
                    })
                });
                
                const result = await response.json();
                
                if (!response.ok || !result.success) {
                    // –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    return;
                }
                
                // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
                addMessageToDialog(responseText, true, true);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∏–∑—É –¥–∏–∞–ª–æ–≥–∞ –ú–ì–ù–û–í–ï–ù–ù–û
                scrollToBottom(true, true);
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                input.value = '';
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
                currentDialogMessagesCount++;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞');
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –æ—Ç–ø—Ä–∞–≤–∫–∏
        function addTemporaryMessage(message, isFromUser) {
            const container = document.getElementById('my-issue-dialog-content');
            if (!container) return;
            
            let messagesContainer = container.querySelector('.dialog-messages');
            if (!messagesContainer) {
                messagesContainer = document.createElement('div');
                messagesContainer.className = 'dialog-messages';
                container.appendChild(messagesContainer);
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message temp-message';
            messageDiv.style.cssText = `
                margin: 10px 0;
                padding: 12px 15px;
                border-radius: 12px;
                max-width: 80%;
                word-wrap: break-word;
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                margin-left: auto;
                text-align: right;
                opacity: 0.7;
                border: 2px dashed rgba(255,255,255,0.3);
            `;
            
            messageDiv.innerHTML = `
                <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px;">
                    üë§ –í—ã ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...
                </div>
                <div>${message.response_text}</div>
                <div style="margin-top: 5px; font-size: 11px; opacity: 0.6;">
                    <span class="sending-dots">‚óè‚óè‚óè</span>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
            const style = document.createElement('style');
            style.textContent = `
                .sending-dots {
                    animation: sending-pulse 1s infinite;
                }
                @keyframes sending-pulse {
                    0%, 100% { opacity: 0.3; }
                    50% { opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom(true, true);
        }
        
        // –£–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function removeTemporaryMessage() {
            const tempMessage = document.querySelector('.temp-message');
            if (tempMessage) {
                tempMessage.style.opacity = '0';
                tempMessage.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    if (tempMessage.parentNode) {
                        tempMessage.parentNode.removeChild(tempMessage);
                    }
                }, 300);
            }
        }
        
        function handleMyResponseEnterKey(event) {
            if (event.key === 'Enter') {
                sendMyResponse();
            }
        }
        
        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
        let typingTimeout = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—á–∞—Ç–∏
        let userTypingTimeout = null;
        let adminTypingTimeout = null;
        
        function handleUserTyping() {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –µ–≥–æ —á–∞—Ç–µ
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É
            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç...');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            if (userTypingTimeout) {
                clearTimeout(userTypingTimeout);
            }
            
            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–µ—á–∞—Ç–∏
            userTypingTimeout = setTimeout(() => {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å');
            }, 2000);
        }
        
        function handleAdminTyping() {
            // –ê–¥–º–∏–Ω –ø–µ—á–∞—Ç–∞–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            showUserTypingIndicator(true);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            if (adminTypingTimeout) {
                clearTimeout(adminTypingTimeout);
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
            adminTypingTimeout = setTimeout(() => {
                showUserTypingIndicator(false);
            }, 2000);
        }
        
        function showUserTypingIndicator(show) {
            const container = document.getElementById('my-issue-dialog-content');
            if (!container) return;
            
            let indicator = container.querySelector('.typing-indicator');
            
            if (show && !indicator) {
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                indicator = document.createElement('div');
                indicator.className = 'typing-indicator';
                indicator.style.cssText = `
                    background: rgba(255,255,255,0.1);
                    padding: 10px 15px;
                    border-radius: 12px;
                    margin: 10px 0;
                    max-width: 80%;
                    margin-right: auto;
                    opacity: 0;
                    transform: translateY(10px);
                    transition: all 0.3s ease;
                `;
                
                indicator.innerHTML = `
                    <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px;">
                        üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∞–µ—Ç...
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div class="typing-dots">
                            <span>‚óè</span>
                            <span>‚óè</span>
                            <span>‚óè</span>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–æ—á–µ–∫
                const style = document.createElement('style');
                style.textContent = `
                    .typing-dots span {
                        display: inline-block;
                        margin: 0 2px;
                        opacity: 0.4;
                        animation: typing-pulse 1.4s infinite;
                    }
                    .typing-dots span:nth-child(2) {
                        animation-delay: 0.2s;
                    }
                    .typing-dots span:nth-child(3) {
                        animation-delay: 0.4s;
                    }
                    @keyframes typing-pulse {
                        0%, 60%, 100% { opacity: 0.4; }
                        30% { opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                
                container.appendChild(indicator);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    indicator.style.opacity = '1';
                    indicator.style.transform = 'translateY(0)';
                }, 10);
                
                scrollToBottom(true, true);
                
            } else if (!show && indicator) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                indicator.style.opacity = '0';
                indicator.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }
        }
        
        async function markResponsesAsRead(issueId) {
            try {
                await fetch(`http://localhost:5000/api/mark-responses-read/${issueId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: tg.initData
                    })
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadUserData();

        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
        (function(){
            function applyCompact() {
                const w = window.innerWidth; 
                const h = window.innerHeight;
                // –£–±–∏—Ä–∞–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                const compact = false;
                document.body.classList.toggle('compact', compact);
                document.documentElement.style.setProperty('--vh', `${h * 0.01}px`);
            }
            window.addEventListener('resize', applyCompact, { passive: true });
            applyCompact();
        })();
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç" –≤ —á–∞—Ç–µ –∞–¥–º–∏–Ω–∞
        function showAdminTypingIndicator(show) {
            const container = document.getElementById('issue-dialog-content');
            if (!container) return;
            
            let indicator = container.querySelector('.admin-typing-indicator');
            
            if (show && !indicator) {
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                indicator = document.createElement('div');
                indicator.className = 'admin-typing-indicator';
                indicator.style.cssText = `
                    background: rgba(255,255,255,0.1);
                    padding: 10px 15px;
                    border-radius: 12px;
                    margin: 10px 0;
                    max-width: 80%;
                    margin-left: auto;
                    opacity: 0;
                    transform: translateY(10px);
                    transition: all 0.3s ease;
                `;
                
                indicator.innerHTML = `
                    <div style="font-size: 12px; opacity: 0.7; margin-bottom: 5px; text-align: right;">
                        üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç...
                    </div>
                    <div style="display: flex; align-items: center; justify-content: flex-end;">
                        <div class="typing-dots">
                            <span>‚óè</span>
                            <span>‚óè</span>
                            <span>‚óè</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(indicator);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    indicator.style.opacity = '1';
                    indicator.style.transform = 'translateY(0)';
                }, 10);
                
                scrollToBottom(true, true);
                
            } else if (!show && indicator) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                indicator.style.opacity = '0';
                indicator.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }
        }
    </script>
</body>
</html>
